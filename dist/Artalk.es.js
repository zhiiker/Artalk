"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t,e={exports:{}};t=e,function(e){var i={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:/^ {0,3}(`{3,}|~{3,})([^`~\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?:\n+|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6}) +([^\n]*?)(?: +#+)? *(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3})(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:"^ {0,3}(?:<(script|pre|style)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?\\?>\\n*|<![A-Z][\\s\\S]*?>\\n*|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>\\n*|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:\\n{2,}|$)|<(?!script|pre|style)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$)|</(?!script|pre|style)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$))",def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,nptable:f,table:f,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html)[^\n]+)*)/,text:/^[^\n]+/};function n(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||b.defaults,this.rules=i.normal,this.options.pedantic?this.rules=i.pedantic:this.options.gfm&&(this.rules=i.gfm)}i._label=/(?!\s*\])(?:\\[\[\]]|[^\[\]])+/,i._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/,i.def=p(i.def).replace("label",i._label).replace("title",i._title).getRegex(),i.bullet=/(?:[*+-]|\d{1,9}\.)/,i.item=/^( *)(bull) ?[^\n]*(?:\n(?!\1bull ?)[^\n]*)*/,i.item=p(i.item,"gm").replace(/bull/g,i.bullet).getRegex(),i.list=p(i.list).replace(/bull/g,i.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+i.def.source+")").getRegex(),i._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",i._comment=/<!--(?!-?>)[\s\S]*?-->/,i.html=p(i.html,"i").replace("comment",i._comment).replace("tag",i._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),i.paragraph=p(i._paragraph).replace("hr",i.hr).replace("heading"," {0,3}#{1,6} +").replace("|lheading","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}|~{3,})[^`\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",i._tag).getRegex(),i.blockquote=p(i.blockquote).replace("paragraph",i.paragraph).getRegex(),i.normal=k({},i),i.gfm=k({},i.normal,{nptable:/^ *([^|\n ].*\|.*)\n *([-:]+ *\|[-| :]*)(?:\n((?:.*[^>\n ].*(?:\n|$))*)\n*|$)/,table:/^ *\|(.+)\n *\|?( *[-:]+[-| :]*)(?:\n((?: *[^>\n ].*(?:\n|$))*)\n*|$)/}),i.pedantic=k({},i.normal,{html:p("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",i._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *(?:#+ *)?(?:\n+|$)/,fences:f,paragraph:p(i.normal._paragraph).replace("hr",i.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",i.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()}),n.rules=i,n.lex=function(t,e){return new n(e).lex(t)},n.prototype.lex=function(t){return t=t.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(t,!0)},n.prototype.token=function(t,e){var n,s,a,r,o,l,c,h,p,u,m,g,f,k,v,E;for(t=t.replace(/^ +$/gm,"");t;)if((a=this.rules.newline.exec(t))&&(t=t.substring(a[0].length),a[0].length>1&&this.tokens.push({type:"space"})),a=this.rules.code.exec(t)){var b=this.tokens[this.tokens.length-1];t=t.substring(a[0].length),b&&"paragraph"===b.type?b.text+="\n"+a[0].trimRight():(a=a[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",codeBlockStyle:"indented",text:this.options.pedantic?a:x(a,"\n")}))}else if(a=this.rules.fences.exec(t))t=t.substring(a[0].length),this.tokens.push({type:"code",lang:a[2]?a[2].trim():a[2],text:a[3]||""});else if(a=this.rules.heading.exec(t))t=t.substring(a[0].length),this.tokens.push({type:"heading",depth:a[1].length,text:a[2]});else if((a=this.rules.nptable.exec(t))&&(l={type:"table",header:y(a[1].replace(/^ *| *\| *$/g,"")),align:a[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:a[3]?a[3].replace(/\n$/,"").split("\n"):[]}).header.length===l.align.length){for(t=t.substring(a[0].length),m=0;m<l.align.length;m++)/^ *-+: *$/.test(l.align[m])?l.align[m]="right":/^ *:-+: *$/.test(l.align[m])?l.align[m]="center":/^ *:-+ *$/.test(l.align[m])?l.align[m]="left":l.align[m]=null;for(m=0;m<l.cells.length;m++)l.cells[m]=y(l.cells[m],l.header.length);this.tokens.push(l)}else if(a=this.rules.hr.exec(t))t=t.substring(a[0].length),this.tokens.push({type:"hr"});else if(a=this.rules.blockquote.exec(t))t=t.substring(a[0].length),this.tokens.push({type:"blockquote_start"}),a=a[0].replace(/^ *> ?/gm,""),this.token(a,e),this.tokens.push({type:"blockquote_end"});else if(a=this.rules.list.exec(t)){for(t=t.substring(a[0].length),c={type:"list_start",ordered:k=(r=a[2]).length>1,start:k?+r:"",loose:!1},this.tokens.push(c),h=[],n=!1,f=(a=a[0].match(this.rules.item)).length,m=0;m<f;m++)u=(l=a[m]).length,~(l=l.replace(/^ *([*+-]|\d+\.) */,"")).indexOf("\n ")&&(u-=l.length,l=this.options.pedantic?l.replace(/^ {1,4}/gm,""):l.replace(new RegExp("^ {1,"+u+"}","gm"),"")),m!==f-1&&(o=i.bullet.exec(a[m+1])[0],(r.length>1?1===o.length:o.length>1||this.options.smartLists&&o!==r)&&(t=a.slice(m+1).join("\n")+t,m=f-1)),s=n||/\n\n(?!\s*$)/.test(l),m!==f-1&&(n="\n"===l.charAt(l.length-1),s||(s=n)),s&&(c.loose=!0),E=void 0,(v=/^\[[ xX]\] /.test(l))&&(E=" "!==l[1],l=l.replace(/^\[[ xX]\] +/,"")),p={type:"list_item_start",task:v,checked:E,loose:s},h.push(p),this.tokens.push(p),this.token(l,!1),this.tokens.push({type:"list_item_end"});if(c.loose)for(f=h.length,m=0;m<f;m++)h[m].loose=!0;this.tokens.push({type:"list_end"})}else if(a=this.rules.html.exec(t))t=t.substring(a[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===a[1]||"script"===a[1]||"style"===a[1]),text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(a[0]):d(a[0]):a[0]});else if(e&&(a=this.rules.def.exec(t)))t=t.substring(a[0].length),a[3]&&(a[3]=a[3].substring(1,a[3].length-1)),g=a[1].toLowerCase().replace(/\s+/g," "),this.tokens.links[g]||(this.tokens.links[g]={href:a[2],title:a[3]});else if((a=this.rules.table.exec(t))&&(l={type:"table",header:y(a[1].replace(/^ *| *\| *$/g,"")),align:a[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:a[3]?a[3].replace(/\n$/,"").split("\n"):[]}).header.length===l.align.length){for(t=t.substring(a[0].length),m=0;m<l.align.length;m++)/^ *-+: *$/.test(l.align[m])?l.align[m]="right":/^ *:-+: *$/.test(l.align[m])?l.align[m]="center":/^ *:-+ *$/.test(l.align[m])?l.align[m]="left":l.align[m]=null;for(m=0;m<l.cells.length;m++)l.cells[m]=y(l.cells[m].replace(/^ *\| *| *\| *$/g,""),l.header.length);this.tokens.push(l)}else if(a=this.rules.lheading.exec(t))t=t.substring(a[0].length),this.tokens.push({type:"heading",depth:"="===a[2].charAt(0)?1:2,text:a[1]});else if(e&&(a=this.rules.paragraph.exec(t)))t=t.substring(a[0].length),this.tokens.push({type:"paragraph",text:"\n"===a[1].charAt(a[1].length-1)?a[1].slice(0,-1):a[1]});else if(a=this.rules.text.exec(t))t=t.substring(a[0].length),this.tokens.push({type:"text",text:a[0]});else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0));return this.tokens};var s={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:f,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(?!\s*\])((?:\\[\[\]]?|[^\[\]\\])+)\]/,nolink:/^!?\[(?!\s*\])((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\](?:\[\])?/,strong:/^__([^\s_])__(?!_)|^\*\*([^\s*])\*\*(?!\*)|^__([^\s][\s\S]*?[^\s])__(?!_)|^\*\*([^\s][\s\S]*?[^\s])\*\*(?!\*)/,em:/^_([^\s_])_(?!_)|^\*([^\s*<\[])\*(?!\*)|^_([^\s<][\s\S]*?[^\s_])_(?!_|[^\spunctuation])|^_([^\s_<][\s\S]*?[^\s])_(?!_|[^\spunctuation])|^\*([^\s<"][\s\S]*?[^\s\*])\*(?!\*|[^\spunctuation])|^\*([^\s*"<\[][\s\S]*?[^\s])\*(?!\*)/,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:f,text:/^(`+|[^`])(?:[\s\S]*?(?:(?=[\\<!\[`*]|\b_|$)|[^ ](?= {2,}\n))|(?= {2,}\n))/};function a(t,e){if(this.options=e||b.defaults,this.links=t,this.rules=s.normal,this.renderer=this.options.renderer||new r,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.pedantic?this.rules=s.pedantic:this.options.gfm&&(this.options.breaks?this.rules=s.breaks:this.rules=s.gfm)}function r(t){this.options=t||b.defaults}function o(){}function l(t){this.tokens=[],this.token=null,this.options=t||b.defaults,this.options.renderer=this.options.renderer||new r,this.renderer=this.options.renderer,this.renderer.options=this.options,this.slugger=new c}function c(){this.seen={}}function d(t,e){if(e){if(d.escapeTest.test(t))return t.replace(d.escapeReplace,(function(t){return d.replacements[t]}))}else if(d.escapeTestNoEncode.test(t))return t.replace(d.escapeReplaceNoEncode,(function(t){return d.replacements[t]}));return t}function h(t){return t.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(t,e){return"colon"===(e=e.toLowerCase())?":":"#"===e.charAt(0)?"x"===e.charAt(1)?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""}))}function p(t,e){return t=t.source||t,e=e||"",{replace:function(e,i){return i=(i=i.source||i).replace(/(^|[^\[])\^/g,"$1"),t=t.replace(e,i),this},getRegex:function(){return new RegExp(t,e)}}}function u(t,e,i){if(t){try{var n=decodeURIComponent(h(i)).replace(/[^\w:]/g,"").toLowerCase()}catch(s){return null}if(0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")||0===n.indexOf("data:"))return null}e&&!g.test(i)&&(i=function(t,e){return m[" "+t]||(/^[^:]+:\/*[^/]*$/.test(t)?m[" "+t]=t+"/":m[" "+t]=x(t,"/",!0)),t=m[" "+t],"//"===e.slice(0,2)?t.replace(/:[\s\S]*/,":")+e:"/"===e.charAt(0)?t.replace(/(:\/*[^/]*)[\s\S]*/,"$1")+e:t+e}(e,i));try{i=encodeURI(i).replace(/%25/g,"%")}catch(s){return null}return i}s._punctuation="!\"#$%&'()*+,\\-./:;<=>?@\\[^_{|}~",s.em=p(s.em).replace(/punctuation/g,s._punctuation).getRegex(),s._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,s._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,s._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,s.autolink=p(s.autolink).replace("scheme",s._scheme).replace("email",s._email).getRegex(),s._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,s.tag=p(s.tag).replace("comment",i._comment).replace("attribute",s._attribute).getRegex(),s._label=/(?:\[[^\[\]]*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,s._href=/<(?:\\[<>]?|[^\s<>\\])*>|[^\s\x00-\x1f]*/,s._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,s.link=p(s.link).replace("label",s._label).replace("href",s._href).replace("title",s._title).getRegex(),s.reflink=p(s.reflink).replace("label",s._label).getRegex(),s.normal=k({},s),s.pedantic=k({},s.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/,link:p(/^!?\[(label)\]\((.*?)\)/).replace("label",s._label).getRegex(),reflink:p(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",s._label).getRegex()}),s.gfm=k({},s.normal,{escape:p(s.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~+(?=\S)([\s\S]*?\S)~+/,text:/^(`+|[^`])(?:[\s\S]*?(?:(?=[\\<!\[`*~]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))|(?= {2,}\n|[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))/}),s.gfm.url=p(s.gfm.url,"i").replace("email",s.gfm._extended_email).getRegex(),s.breaks=k({},s.gfm,{br:p(s.br).replace("{2,}","*").getRegex(),text:p(s.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()}),a.rules=s,a.output=function(t,e,i){return new a(e,i).output(t)},a.prototype.output=function(t){for(var e,i,n,s,r,o,l="";t;)if(r=this.rules.escape.exec(t))t=t.substring(r[0].length),l+=d(r[1]);else if(r=this.rules.tag.exec(t))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(r[0])&&(this.inLink=!1),!this.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(r[0])?this.inRawBlock=!0:this.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(r[0])&&(this.inRawBlock=!1),t=t.substring(r[0].length),l+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):d(r[0]):r[0];else if(r=this.rules.link.exec(t)){var c=v(r[2],"()");if(c>-1){var h=4+r[1].length+c;r[2]=r[2].substring(0,c),r[0]=r[0].substring(0,h).trim(),r[3]=""}t=t.substring(r[0].length),this.inLink=!0,n=r[2],this.options.pedantic?(e=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(n))?(n=e[1],s=e[3]):s="":s=r[3]?r[3].slice(1,-1):"",n=n.trim().replace(/^<([\s\S]*)>$/,"$1"),l+=this.outputLink(r,{href:a.escapes(n),title:a.escapes(s)}),this.inLink=!1}else if((r=this.rules.reflink.exec(t))||(r=this.rules.nolink.exec(t))){if(t=t.substring(r[0].length),e=(r[2]||r[1]).replace(/\s+/g," "),!(e=this.links[e.toLowerCase()])||!e.href){l+=r[0].charAt(0),t=r[0].substring(1)+t;continue}this.inLink=!0,l+=this.outputLink(r,e),this.inLink=!1}else if(r=this.rules.strong.exec(t))t=t.substring(r[0].length),l+=this.renderer.strong(this.output(r[4]||r[3]||r[2]||r[1]));else if(r=this.rules.em.exec(t))t=t.substring(r[0].length),l+=this.renderer.em(this.output(r[6]||r[5]||r[4]||r[3]||r[2]||r[1]));else if(r=this.rules.code.exec(t))t=t.substring(r[0].length),l+=this.renderer.codespan(d(r[2].trim(),!0));else if(r=this.rules.br.exec(t))t=t.substring(r[0].length),l+=this.renderer.br();else if(r=this.rules.del.exec(t))t=t.substring(r[0].length),l+=this.renderer.del(this.output(r[1]));else if(r=this.rules.autolink.exec(t))t=t.substring(r[0].length),n="@"===r[2]?"mailto:"+(i=d(this.mangle(r[1]))):i=d(r[1]),l+=this.renderer.link(n,null,i);else if(this.inLink||!(r=this.rules.url.exec(t))){if(r=this.rules.text.exec(t))t=t.substring(r[0].length),this.inRawBlock?l+=this.renderer.text(this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):d(r[0]):r[0]):l+=this.renderer.text(d(this.smartypants(r[0])));else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0))}else{if("@"===r[2])n="mailto:"+(i=d(r[0]));else{do{o=r[0],r[0]=this.rules._backpedal.exec(r[0])[0]}while(o!==r[0]);i=d(r[0]),n="www."===r[1]?"http://"+i:i}t=t.substring(r[0].length),l+=this.renderer.link(n,null,i)}return l},a.escapes=function(t){return t?t.replace(a.rules._escapes,"$1"):t},a.prototype.outputLink=function(t,e){var i=e.href,n=e.title?d(e.title):null;return"!"!==t[0].charAt(0)?this.renderer.link(i,n,this.output(t[1])):this.renderer.image(i,n,d(t[1]))},a.prototype.smartypants=function(t){return this.options.smartypants?t.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):t},a.prototype.mangle=function(t){if(!this.options.mangle)return t;for(var e,i="",n=t.length,s=0;s<n;s++)e=t.charCodeAt(s),Math.random()>.5&&(e="x"+e.toString(16)),i+="&#"+e+";";return i},r.prototype.code=function(t,e,i){var n=(e||"").match(/\S*/)[0];if(this.options.highlight){var s=this.options.highlight(t,n);null!=s&&s!==t&&(i=!0,t=s)}return n?'<pre><code class="'+this.options.langPrefix+d(n,!0)+'">'+(i?t:d(t,!0))+"</code></pre>\n":"<pre><code>"+(i?t:d(t,!0))+"</code></pre>"},r.prototype.blockquote=function(t){return"<blockquote>\n"+t+"</blockquote>\n"},r.prototype.html=function(t){return t},r.prototype.heading=function(t,e,i,n){return this.options.headerIds?"<h"+e+' id="'+this.options.headerPrefix+n.slug(i)+'">'+t+"</h"+e+">\n":"<h"+e+">"+t+"</h"+e+">\n"},r.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},r.prototype.list=function(t,e,i){var n=e?"ol":"ul";return"<"+n+(e&&1!==i?' start="'+i+'"':"")+">\n"+t+"</"+n+">\n"},r.prototype.listitem=function(t){return"<li>"+t+"</li>\n"},r.prototype.checkbox=function(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},r.prototype.paragraph=function(t){return"<p>"+t+"</p>\n"},r.prototype.table=function(t,e){return e&&(e="<tbody>"+e+"</tbody>"),"<table>\n<thead>\n"+t+"</thead>\n"+e+"</table>\n"},r.prototype.tablerow=function(t){return"<tr>\n"+t+"</tr>\n"},r.prototype.tablecell=function(t,e){var i=e.header?"th":"td";return(e.align?"<"+i+' align="'+e.align+'">':"<"+i+">")+t+"</"+i+">\n"},r.prototype.strong=function(t){return"<strong>"+t+"</strong>"},r.prototype.em=function(t){return"<em>"+t+"</em>"},r.prototype.codespan=function(t){return"<code>"+t+"</code>"},r.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},r.prototype.del=function(t){return"<del>"+t+"</del>"},r.prototype.link=function(t,e,i){if(null===(t=u(this.options.sanitize,this.options.baseUrl,t)))return i;var n='<a href="'+d(t)+'"';return e&&(n+=' title="'+e+'"'),n+=">"+i+"</a>"},r.prototype.image=function(t,e,i){if(null===(t=u(this.options.sanitize,this.options.baseUrl,t)))return i;var n='<img src="'+t+'" alt="'+i+'"';return e&&(n+=' title="'+e+'"'),n+=this.options.xhtml?"/>":">"},r.prototype.text=function(t){return t},o.prototype.strong=o.prototype.em=o.prototype.codespan=o.prototype.del=o.prototype.text=function(t){return t},o.prototype.link=o.prototype.image=function(t,e,i){return""+i},o.prototype.br=function(){return""},l.parse=function(t,e){return new l(e).parse(t)},l.prototype.parse=function(t){this.inline=new a(t.links,this.options),this.inlineText=new a(t.links,k({},this.options,{renderer:new o})),this.tokens=t.reverse();for(var e="";this.next();)e+=this.tok();return e},l.prototype.next=function(){return this.token=this.tokens.pop(),this.token},l.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},l.prototype.parseText=function(){for(var t=this.token.text;"text"===this.peek().type;)t+="\n"+this.next().text;return this.inline.output(t)},l.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,h(this.inlineText.output(this.token.text)),this.slugger);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var t,e,i,n,s="",a="";for(i="",t=0;t<this.token.header.length;t++)i+=this.renderer.tablecell(this.inline.output(this.token.header[t]),{header:!0,align:this.token.align[t]});for(s+=this.renderer.tablerow(i),t=0;t<this.token.cells.length;t++){for(e=this.token.cells[t],i="",n=0;n<e.length;n++)i+=this.renderer.tablecell(this.inline.output(e[n]),{header:!1,align:this.token.align[n]});a+=this.renderer.tablerow(i)}return this.renderer.table(s,a);case"blockquote_start":for(a="";"blockquote_end"!==this.next().type;)a+=this.tok();return this.renderer.blockquote(a);case"list_start":a="";for(var r=this.token.ordered,o=this.token.start;"list_end"!==this.next().type;)a+=this.tok();return this.renderer.list(a,r,o);case"list_item_start":a="";var l=this.token.loose,c=this.token.checked,d=this.token.task;for(this.token.task&&(a+=this.renderer.checkbox(c));"list_item_end"!==this.next().type;)a+=l||"text"!==this.token.type?this.tok():this.parseText();return this.renderer.listitem(a,d,c);case"html":return this.renderer.html(this.token.text);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText());default:var p='Token with "'+this.token.type+'" type was not found.';if(!this.options.silent)throw new Error(p);console.log(p)}},c.prototype.slug=function(t){var e=t.toLowerCase().trim().replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-");if(this.seen.hasOwnProperty(e)){var i=e;do{this.seen[i]++,e=i+"-"+this.seen[i]}while(this.seen.hasOwnProperty(e))}return this.seen[e]=0,e},d.escapeTest=/[&<>"']/,d.escapeReplace=/[&<>"']/g,d.replacements={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},d.escapeTestNoEncode=/[<>"']|&(?!#?\w+;)/,d.escapeReplaceNoEncode=/[<>"']|&(?!#?\w+;)/g;var m={},g=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function f(){}function k(t){for(var e,i,n=1;n<arguments.length;n++)for(i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}function y(t,e){var i=t.replace(/\|/g,(function(t,e,i){for(var n=!1,s=e;--s>=0&&"\\"===i[s];)n=!n;return n?"|":" |"})).split(/ \|/),n=0;if(i.length>e)i.splice(e);else for(;i.length<e;)i.push("");for(;n<i.length;n++)i[n]=i[n].trim().replace(/\\\|/g,"|");return i}function x(t,e,i){if(0===t.length)return"";for(var n=0;n<t.length;){var s=t.charAt(t.length-n-1);if(s!==e||i){if(s===e||!i)break;n++}else n++}return t.substr(0,t.length-n)}function v(t,e){if(-1===t.indexOf(e[1]))return-1;for(var i=0,n=0;n<t.length;n++)if("\\"===t[n])n++;else if(t[n]===e[0])i++;else if(t[n]===e[1]&&--i<0)return n;return-1}function E(t){t&&t.sanitize&&!t.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function b(t,e,i){if(null==t)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof t)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected");if(i||"function"==typeof e){i||(i=e,e=null),E(e=k({},b.defaults,e||{}));var s,a,r=e.highlight,o=0;try{s=n.lex(t,e)}catch(h){return i(h)}a=s.length;var c=function(t){if(t)return e.highlight=r,i(t);var n;try{n=l.parse(s,e)}catch(h){t=h}return e.highlight=r,t?i(t):i(null,n)};if(!r||r.length<3)return c();if(delete e.highlight,!a)return c();for(;o<s.length;o++)!function(t){"code"!==t.type?--a||c():r(t.text,t.lang,(function(e,i){return e?c(e):null==i||i===t.text?--a||c():(t.text=i,t.escaped=!0,void(--a||c()))}))}(s[o])}else try{return e&&(e=k({},b.defaults,e)),E(e),l.parse(n.lex(t,e),e)}catch(h){if(h.message+="\nPlease report this to https://github.com/markedjs/marked.",(e||b.defaults).silent)return"<p>An error occurred:</p><pre>"+d(h.message+"",!0)+"</pre>";throw h}}f.exec=f,b.options=b.setOptions=function(t){return k(b.defaults,t),b},b.getDefaults=function(){return{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:new r,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,xhtml:!1}},b.defaults=b.getDefaults(),b.Parser=l,b.parser=l.parse,b.Renderer=r,b.TextRenderer=o,b.Lexer=n,b.lexer=n.lex,b.InlineLexer=a,b.inlineLexer=a.output,b.Slugger=c,b.parse=b,t.exports=b}();var i=e.exports,n={exports:{}},s=n.exports=function(){function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e=t((function(t){var e=t.exports=function(){return new RegExp("(?:"+e.line().source+")|(?:"+e.block().source+")","gm")};e.line=function(){return/(?:^|\s)\/\/(.+?)$/gm},e.block=function(){return/\/\*([\S\s]*?)\*\//gm}})),i=["23AC69","91C132","F19726","E8552D","1AAB8E","E1147F","2980C1","1BA1E6","9FA0A0","F19726","E30B20","E30B20","A3338B"];function n(t){return'<span style="color: slategray">'+t+"</span>"}return function(t,s){void 0===s&&(s={});var a=s.colors;void 0===a&&(a=i);var r=0,o={},l=new RegExp("("+/[\u4E00-\u9FFF\u3400-\u4dbf\uf900-\ufaff\u3040-\u309f\uac00-\ud7af\u0400-\u04FF]+|\w+/.source+"|"+/</.source+")|("+e().source+")","gmi");return t.replace(l,(function(t,e,i){if(i)return n(i);if("<"===e)return"&lt;";var s;o[e]?s=o[e]:(s=a[r],o[e]=s);var l='<span style="color: #'+s+'">'+e+"</span>";return r=++r%a.length,l}))}}();function a(t=""){const e=document.createElement("div");return e.innerHTML=t.trim(),e.firstElementChild||e}function r(t){const e=RegExp(`[?&]${t}=([^&]*)`).exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))}function o(t){const e=t.getBoundingClientRect();return{top:e.top+window.scrollY,left:e.left+window.scrollX}}function l(t,e){let i=t.toString();for(;i.length<e;)i=`0${i}`;return i}function c(t){try{const e=t.getTime(),i=(new Date).getTime()-e,n=Math.floor(i/864e5);if(0===n){const t=i%864e5,e=Math.floor(t/36e5);if(0===e){const e=t%36e5,i=Math.floor(e/6e4);if(0===i){const t=e%6e4;return`${Math.round(t/1e3)} 秒前`}return`${i} 分钟前`}return`${e} 小时前`}return n<0?"刚刚":n<8?`${n} 天前`:function(t){const e=l(t.getDate(),2),i=l(t.getMonth()+1,2);return`${l(t.getFullYear(),2)}-${i}-${e}`}(t)}catch(e){return console.error(e)," - "}}let d=null;function h(t,e){if(!d){const t=new i.Renderer,e=t.link;t.link=(i,n,s)=>e.call(t,i,n,s).replace(/^<a /,'<a target="_blank" rel="nofollow" ');const n=i;n.setOptions({renderer:t,highlight:t=>s(t),pedantic:!1,gfm:!0,tables:!0,breaks:!0,sanitize:!0,smartLists:!0,smartypants:!0,xhtml:!1}),d=n}return d(e)}class p{data;constructor(t){const e=JSON.parse(window.localStorage.getItem("ArtalkUser")||"{}");this.data={nick:e.nick||"",email:e.email||"",link:e.link||"",token:e.token||"",isAdmin:e.isAdmin||!1}}save(){window.localStorage.setItem("ArtalkUser",JSON.stringify(this.data))}checkHasBasicUserInfo(){return!!this.data.nick&&!!this.data.email}}class u{cid;rootEl;conf;user;eventList=[];constructor(t,e){this.cid=+new Date,this.rootEl=t,this.conf=e,this.user=new p(this.conf)}addEventListener(t,e){this.eventList.push({name:t,listener:e})}removeEventListener(t){this.eventList=this.eventList.filter((e=>e.name!==t))}dispatchEvent(t,e){this.eventList.filter((e=>e.name===t)).map((t=>t.listener)).forEach((t=>t(e)))}}function m(t){t instanceof u&&(t=t.rootEl);let e=t.querySelector(".atk-loading");e||(e=a('\n        <div class="atk-loading" style="display: none;">\n          <div class="atk-loading-spinner">\n          <svg viewBox="25 25 50 50"><circle cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"></circle></svg>\n          </div>\n          </div>'),t.appendChild(e)),e.style.display=""}function g(t){t instanceof u&&(t=t.rootEl);const e=t.querySelector(".atk-loading");e&&(e.style.display="none")}function f(t){const e=window.scrollY,i=e+document.documentElement.clientHeight,n=o(t).top;return n+t.offsetHeight<=i&&n>=e}function k(t,e=!0){if(f(t))return;const i=o(t).top+parseFloat(getComputedStyle(t,null).height.replace("px",""))/2-document.documentElement.clientHeight/2;e?window.scroll({top:i>0?i:0,left:0,behavior:"smooth"}):window.scroll(0,i>0?i:0)}function y(t,e,i){const n=a(`<div class="atk-notify atk-fade-in" style="background-color: ${{s:"#57d59f",e:"#ff6f6c",w:"#ffc721",i:"#2ebcfc"}[i]}"><span class="atk-notify-content"></span></div>`);n.querySelector(".atk-notify-content").innerHTML=function(t){const e=document.createElement("div");return e.innerText=t,e.innerHTML}(e).replace("\n","<br/>"),t.appendChild(n);const s=()=>{n.classList.add("atk-fade-out"),setTimeout((()=>{n.remove()}),200)};let r;r=window.setTimeout((()=>{s()}),3e3),n.addEventListener("click",(()=>{s(),window.clearTimeout(r)}))}function x(t,e){!function(t,e,i="in"){t.classList.add(`atk-fade-${i}`);const n=()=>{t.classList.remove(`atk-fade-${i}`),t.removeEventListener("animationend",n),e&&e()};t.addEventListener("animationend",n)}(t,e,"in")}function v(t,e){t instanceof u&&(t=t.rootEl);let i=t.querySelector(".atk-error-layer");if(null===e)return void(null!==i&&i.remove());i||(i=a('<div class="atk-error-layer"><span class="atk-error-title">Artalk Error</span><span class="atk-error-text"></span></div>'),t.appendChild(i));const n=i.querySelector(".atk-error-text");n.innerHTML="",null!==e&&(e instanceof HTMLElement?n.appendChild(e):n.innerText=e)}class E{el;ctx;conf;constructor(t){this.ctx=t,this.conf=t.conf}}const b="atk-dark-mode";function w(t){let e=document.querySelector(`.atk-layer-wrap#ctx-${t.cid}`);e||(e=a(`<div class="atk-layer-wrap" id="ctx-${t.cid}" style="display: none;"><div class="atk-layer-mask"></div></div>`),document.body.appendChild(e));const i=e.querySelector(".atk-layer-mask");return e&&(t.conf.darkMode?e.classList.add(b):e.classList.remove(b)),{wrapEl:e,maskEl:i}}function S(t,e,i){return new L(t,e,i)}class L extends E{name;wrapEl;maskEl;maskClickHideEnable=!0;constructor(t,e,i){super(t),this.name=e;const{wrapEl:n,maskEl:s}=w(t);this.wrapEl=n,this.maskEl=s,this.el=this.wrapEl.querySelector(`[data-layer-name="${e}"].atk-layer-item`),null===this.el&&(i?this.el=i:(this.el=a(),this.el.classList.add("atk-layer-item"))),this.el.setAttribute("data-layer-name",e),this.el.style.display="none",this.wrapEl.append(this.el)}getName(){return this.name}getWrapEl(){return this.wrapEl}getEl(){return this.el}static hideTimeoutList=[];show(){L.hideTimeoutList.forEach((t=>{clearTimeout(t)})),L.hideTimeoutList=[],this.wrapEl.style.display="block",this.maskEl.style.display="block",this.maskEl.classList.add("atk-fade-in"),this.el.style.display="",this.maskEl.onclick=()=>{this.maskClickHideEnable&&this.hide()},document.body.style.overflow="hidden"}hide(){L.hideTimeoutList.push(window.setTimeout((()=>{this.wrapEl.style.display="none",document.body.style.overflow=""}),450)),this.wrapEl.classList.add("atk-fade-out"),L.hideTimeoutList.push(window.setTimeout((()=>{this.wrapEl.style.display="none",this.wrapEl.classList.remove("atk-fade-out")}),200)),this.el.style.display="none"}setMaskClickHide(t){this.maskClickHideEnable=t}disposeNow(){document.body.style.overflow="",this.el.remove(),this.checkCleanLayer()}dispose(){this.hide(),this.el.remove(),this.checkCleanLayer()}checkCleanLayer(){0===this.getWrapEl().querySelectorAll(".atk-layer-item").length&&(this.wrapEl.style.display="none")}}class _{ctx;serverURL;constructor(t){this.ctx=t,this.serverURL=t.conf.server}get(t,e,i){const n={page_key:this.ctx.conf.pageKey,limit:this.ctx.conf.readMore?.pageSize||15,offset:t};return e&&(n.type=e),this.ctx.user.checkHasBasicUserInfo()&&(n.name=this.ctx.user.data.nick,n.email=this.ctx.user.data.email),this.ctx.conf.site&&(n.site_name=this.ctx.conf.site),i&&i(n),$(this.ctx,`${this.serverURL}/get`,{method:"POST",body:T(n)}).then((t=>t.data))}add(t){const e={name:t.nick,email:t.email,link:t.link,content:t.content,rid:t.rid,page_key:this.ctx.conf.pageKey,page_url:this.ctx.conf.pageUrl||"",page_title:this.ctx.conf.pageTitle||""};return this.ctx.conf.site&&(e.site_name=this.ctx.conf.site),$(this.ctx,`${this.serverURL}/add`,{method:"POST",body:T(e)}).then((t=>t.data.comment))}login(t,e,i){const n={name:t,email:e,password:i};return this.ctx.conf.site&&(n.site_name=this.ctx.conf.site),$(this.ctx,`${this.serverURL}/login`,{method:"POST",body:T(n)}).then((t=>t.data.token))}userGet(t,e){const i=new AbortController,{signal:n}=i,s={name:t,email:e};this.ctx.conf.site&&(s.site_name=this.ctx.conf.site);return{req:$(this.ctx,`${this.serverURL}/user-get`,{method:"POST",body:T(s),signal:n}).then((t=>({user:t.data.user,is_login:t.data.is_login,unread:t.data.unread||[],unread_count:t.data.unread_count||0}))),abort:()=>{i.abort()}}}vote(t,e){const i={target_id:t,type:e};return this.ctx.user.checkHasBasicUserInfo()&&(i.name=this.ctx.user.data.nick,i.email=this.ctx.user.data.email),this.ctx.conf.site&&(i.site_name=this.ctx.conf.site),$(this.ctx,`${this.serverURL}/vote`,{method:"POST",body:T(i)}).then((t=>t.data?.vote_num||0))}markRead(t,e=!1){const i={notify_key:t};return e&&(delete i.notify_key,i.read_all=!0,i.name=this.ctx.user.data.nick,i.email=this.ctx.user.data.email),this.ctx.conf.site&&(i.site_name=this.ctx.conf.site),$(this.ctx,`${this.serverURL}/mark-read`,{method:"POST",body:T(i)}).then((t=>t.success))}captchaGet(){return $(this.ctx,`${this.serverURL}/captcha/refresh`,{method:"GET"}).then((t=>t.success&&t.data.img_data?t.data.img_data:""))}captchaCheck(t){return $(this.ctx,`${this.serverURL}/captcha/check?${new URLSearchParams({value:t})}`,{method:"GET"}).then((t=>!t.success&&t.data.img_data?t.data.img_data:""))}commentEdit(t){const e={...t};return void 0!==e.is_collapsed&&(e.is_collapsed=e.is_collapsed?"1":"0"),void 0!==e.is_pending&&(e.is_pending=e.is_pending?"1":"0"),this.ctx.conf.site&&(e.site_name=this.ctx.conf.site),$(this.ctx,`${this.serverURL}/admin/comment-edit`,{method:"POST",body:T(e)}).then((t=>t.data.comment))}pageEdit(t){const e={id:t.id,key:t.key,title:t.title,admin_only:t.admin_only?"1":"0"};return this.ctx.conf.site&&(e.site_name=this.ctx.conf.site),$(this.ctx,`${this.serverURL}/admin/page-edit`,{method:"POST",body:T(e)}).then((t=>t.data.page))}pageFetch(t){const e={id:t};return $(this.ctx,`${this.serverURL}/admin/page-fetch`,{method:"POST",body:T(e)}).then((t=>t.data.page))}siteGet(){return $(this.ctx,`${this.serverURL}/admin/site-get`,{method:"POST",body:T({})}).then((t=>t.data.sites))}pageGet(t){const e={site_name:t||""};return $(this.ctx,`${this.serverURL}/admin/page-get`,{method:"POST",body:T(e)}).then((t=>t.data.pages))}pageDel(t,e){const i={key:String(t),site_name:e||""};return $(this.ctx,`${this.serverURL}/admin/page-del`,{method:"POST",body:T(i)}).then((t=>t.success))}siteDel(t,e=!1){const i={id:t,del_content:e?"1":"0"};return $(this.ctx,`${this.serverURL}/admin/site-del`,{method:"POST",body:T(i)}).then((t=>t.success))}siteAdd(t,e){const i={name:t,urls:e};return $(this.ctx,`${this.serverURL}/admin/site-add`,{method:"POST",body:T(i)}).then((t=>t.site))}siteEdit(t,e){const i={id:t,name:e.name,urls:e.urls};return $(this.ctx,`${this.serverURL}/admin/site-edit`,{method:"POST",body:T(i)}).then((t=>t.site))}commentDel(t,e){const i={id:String(t),site_name:e||""};return $(this.ctx,`${this.serverURL}/admin/comment-del`,{method:"POST",body:T(i)}).then((t=>t.success))}importer(t,e,i){const n={data:t,type:e,site_name:i||""};return $(this.ctx,`${this.serverURL}/admin/importer`,{method:"POST",body:T(n)}).then((t=>t.success))}}function $(t,e,i){if(t.user.data.token){const e=new Headers;e.set("Authorization",`Bearer ${t.user.data.token}`),i.headers=e}return(n=15e3,s=fetch(e,i),new Promise(((t,e)=>{const i=setTimeout((()=>{e(new Error("promise timeout"))}),n);s.then((e=>{clearTimeout(i),t(e)}),(t=>{clearTimeout(i),e(t)}))}))).then((async n=>{let s=await n.json();const a=(n,s)=>{$(t,e,i).then((t=>{n(t)})).catch((t=>{s(t)}))};if(s.data&&s.data.need_captcha?s=await new Promise(((e,i)=>{t.dispatchEvent("checker-captcha",{imgData:s.data.img_data,onSuccess:()=>{a(e,i)},onCancel:()=>{i(s)}})})):(s.data&&s.data.need_login||401===n.status)&&(s=await new Promise(((e,i)=>{t.dispatchEvent("checker-admin",{onSuccess:()=>{a(e,i)},onCancel:()=>{i(s)}})}))),s.success)return s;throw s}));var n,s}function T(t){const e=new FormData;return Object.keys(t).forEach((i=>e.append(i,String(t[i])))),e}const C={request:(t,e)=>{const i={name:t.user.data.nick,email:t.user.data.email,password:e};return new _(t.ctx).login(i.name,i.email,i.password)},body:()=>a("<span>敲入密码来验证管理员身份：</span>"),onSuccess:(t,e,i,n)=>{t.user.data.isAdmin=!0,t.user.data.token=e,t.user.save(),t.ctx.dispatchEvent("user-changed"),t.ctx.dispatchEvent("list-reload")},onError:(t,e,i,n)=>{}},A={request:(t,e)=>new _(t.ctx).captchaCheck(e),body:t=>{const e=a(`<span><img class="atk-captcha-img" src="${t.submitCaptchaImgData||""}" alt="验证码">敲入验证码继续：</span>`);return e.querySelector(".atk-captcha-img").onclick=()=>{const i=e.querySelector(".atk-captcha-img");new _(t.ctx).captchaGet().then((t=>{i.setAttribute("src",t)})).catch((t=>{console.error("验证码获取失败 ",t)}))},e},onSuccess:(t,e,i,n,s)=>{t.submitCaptchaVal=n},onError:(t,e,i,n)=>{n.querySelector(".atk-captcha-img").click()}};class O{ctx;user;submitCaptchaVal;submitCaptchaImgData;constructor(t){this.ctx=t,this.user=t.user,this.ctx.addEventListener("checker-captcha",(t=>{t.imgData&&(this.submitCaptchaImgData=t.imgData),this.check("captcha",t)})),this.ctx.addEventListener("checker-admin",(t=>{this.check("admin",t)}))}check(t,e){const i={admin:C,captcha:A}[t],n=S(this.ctx,`checker-${(new Date).getTime()}`);n.setMaskClickHide(!1),n.show();const s=a();s.appendChild(i.body(this));const r=a(`<input id="check" type="${"admin"===t?"password":"text"}" required placeholder="">`);let o;s.appendChild(r),setTimeout((()=>{r.focus()}),80),r.onkeyup=t=>{"Enter"!==t.key&&13!==t.keyCode||(t.preventDefault(),n.getEl().querySelector('button[data-action="confirm"]').click())};const l=function(t,e,i){const n=a('<div class="atk-layer-dialog-wrap">\n      <div class="atk-layer-dialog">\n      <div class="atk-layer-dialog-content"></div>\n      <div class="atk-layer-dialog-action">\n      </div>'),s=n.querySelector(".atk-layer-dialog-action"),r=t=>e=>{const i=t(e.currentTarget);void 0!==i&&!0!==i||n.remove()};if("function"==typeof e){const t=a('<button data-action="confirm">确定</button>');t.onclick=r(e),s.appendChild(t)}if("function"==typeof i){const t=a('<button data-action="cancel">取消</button>');t.onclick=r(i),s.appendChild(t)}return n.querySelector(".atk-layer-dialog-content").appendChild(t),n}(s,(t=>{const a=r.value.trim();o||(o=t.innerText);const c=()=>{t.innerText=o||"",t.classList.remove("error")};return t.innerText="加载中...",i.request(this,a).then((t=>{n.disposeNow(),i.onSuccess&&i.onSuccess(this,t,a,s),e.onSuccess&&e.onSuccess(a,l)})).catch((e=>{var n;n=String(e.msg||String(e)),t.innerText=n,t.classList.add("error"),i.onError&&i.onError(this,e,a,s);const o=setTimeout((()=>{c()}),3e3);r.onfocus=()=>{c(),clearTimeout(o)}})),!1}),(()=>(n.disposeNow(),e.onCancel&&e.onCancel(),!1)));n.getEl().append(l),e.onMount&&e.onMount(l)}}class q{editor;ctx;el;constructor(t){this.editor=t,this.ctx=t.ctx}}class M extends q{constructor(t){super(t),this.editor=t,this.emoticons=this.ctx.conf.emoticons,this.initEl()}el;emoticons;listWrapEl;typesEl;initEl(){this.el=a('<div class="atk-editor-plug-emoticons"></div>'),this.listWrapEl=a('<div class="atk-emoticons-list-wrap"></div>'),this.el.append(this.listWrapEl),Object.entries(this.emoticons).forEach((([t,e])=>{const i=a('<div class="atk-emoticons-list" style="display: none;"></div>');this.listWrapEl.append(i),i.setAttribute("data-key",t),i.setAttribute("data-input-type",e.inputType),Object.entries(e.container).forEach((([t,n])=>{const s=a('<span class="atk-emoticons-item"></span>');if(i.append(s),s.setAttribute("title",t),s.setAttribute("data-content",n),"image"===e.inputType){const e=document.createElement("img");e.src=n,e.alt=t,s.append(e)}else s.innerText=n}))})),this.typesEl=a('<div class="atk-emoticons-types"></div>'),this.el.append(this.typesEl),Object.entries(this.emoticons).forEach((([t,e])=>{const i=a("<span />");this.typesEl.append(i),i.setAttribute("data-key",t),i.innerText=t})),this.typesEl.querySelectorAll("span").forEach((t=>{t.addEventListener("click",(t=>{const e=t.currentTarget.getAttribute("data-key");e&&this.openType(e)}))})),Object.keys(this.emoticons).length>0&&this.openType(Object.keys(this.emoticons)[0]),this.listWrapEl.querySelectorAll(".atk-emoticons-item").forEach((t=>{t.onclick=t=>{const e=t.currentTarget,i=e.closest(".atk-emoticons-list").getAttribute("data-input-type"),n=e.getAttribute("title"),s=e.getAttribute("data-content");"image"===i?this.editor.insertContent(`:[${n}]`):this.editor.insertContent(s||"")}}))}openType(t){Array.from(this.listWrapEl.children).forEach((e=>{const i=e;i.getAttribute("data-key")!==t?i.style.display="none":i.style.display=""})),this.typesEl.querySelectorAll("span.active").forEach((t=>t.classList.remove("active"))),this.typesEl.querySelector(`span[data-key="${t}"]`)?.classList.add("active"),this.changeListHeight()}getName(){return"emoticons"}getBtnHtml(){return"表情"}getEl(){return this.el}changeListHeight(){}onShow(){setTimeout((()=>{this.changeListHeight()}),30)}onHide(){this.el.parentElement.style.height=""}transEmoticonImageText(t){return Object.entries(this.emoticons).forEach((([e,i])=>{"image"===i.inputType&&Object.entries(i.container).forEach((([e,i])=>{t=t.split(`:[${e}]`).join(`![${e}](${i}) `)}))})),t}}class B extends q{el;binded=!1;constructor(t){super(t),this.initEl()}initEl(){this.el=a('<div class="atk-editor-plug-preview"></div>'),this.binded=!1}getName(){return"preview"}getBtnHtml(){return'预览 <i title="Markdown is supported"><svg class="markdown" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z"></path></svg></i>'}getEl(){return this.el}onShow(){if(this.updateContent(),!this.binded){const t=()=>{this.updateContent()};this.editor.textareaEl.addEventListener("input",t),this.editor.textareaEl.addEventListener("change",t),this.binded=!0}}onHide(){}updateContent(){"none"!==this.el.style.display&&(this.el.innerHTML=this.editor.getContentMarked())}}class R extends E{LOADABLE_PLUG_LIST=[M,B];plugList={};el;headerEl;textareaWrapEl;textareaEl;closeCommentEl;plugWrapEl;bottomEl;bottomPartLeftEl;plugSwitcherWrapEl;bottomPartRightEl;submitBtn;notifyWrapEl;replyComment=null;sendReplyEl=null;get user(){return this.ctx.user}constructor(t){super(t),this.el=a('<div class="atk-editor">\n  <div class="atk-editor-header">\n    <input name="nick" placeholder="昵称" class="atk-nick" type="text" required="required">\n    <input name="email" placeholder="邮箱" class="atk-email" type="email" required="required">\n    <input name="link" placeholder="网址 (https://)" class="atk-link" type="url">\n  </div>\n  <div class="atk-editor-textarea-wrap">\n    <div class="atk-close-comment" style="display: none;"><span>仅管理员可评论</span></div>\n    <textarea id="atk-editor-textarea" class="atk-editor-textarea" placeholder=""></textarea>\n  </div>\n  <div class="atk-editor-plug-wrap" style="display: none;"></div>\n  <div class="atk-editor-bottom">\n    <div class="atk-editor-bottom-part atk-left atk-editor-plug-switcher-wrap"></div>\n    <div class="atk-editor-bottom-part atk-right">\n      <button type="button" class="atk-send-btn"></button>\n    </div>\n  </div>\n  <div class="atk-editor-notify-wrap"></div>\n</div>\n'),this.headerEl=this.el.querySelector(".atk-editor-header"),this.textareaWrapEl=this.el.querySelector(".atk-editor-textarea-wrap"),this.textareaEl=this.el.querySelector(".atk-editor-textarea"),this.closeCommentEl=this.el.querySelector(".atk-close-comment"),this.plugWrapEl=this.el.querySelector(".atk-editor-plug-wrap"),this.bottomEl=this.el.querySelector(".atk-editor-bottom"),this.bottomPartLeftEl=this.el.querySelector(".atk-editor-bottom-part.atk-left"),this.plugSwitcherWrapEl=this.el.querySelector(".atk-editor-plug-switcher-wrap"),this.bottomPartRightEl=this.el.querySelector(".atk-editor-bottom-part.atk-right"),this.submitBtn=this.el.querySelector(".atk-send-btn"),this.notifyWrapEl=this.el.querySelector(".atk-editor-notify-wrap"),this.initLocalStorage(),this.initHeader(),this.initTextarea(),this.initEditorPlug(),this.initBottomPart(),this.ctx.addEventListener("editor-open-comment",(()=>this.openComment())),this.ctx.addEventListener("editor-close-comment",(()=>this.closeComment())),this.ctx.addEventListener("editor-reply",(t=>this.setReply(t))),this.ctx.addEventListener("editor-show-loading",(()=>m(this.el))),this.ctx.addEventListener("editor-hide-loading",(()=>g(this.el))),this.ctx.addEventListener("editor-notify",(t=>this.showNotify(t.msg,t.type)))}initLocalStorage(){const t=window.localStorage.getItem("ArtalkContent")||"";""!==t.trim()&&(this.showNotify("已自动恢复","i"),this.setContent(t)),this.textareaEl.addEventListener("input",(()=>{this.saveContent()}))}initHeader(){Object.keys(this.user.data).forEach((t=>{const e=this.getInputEl(t);e&&e instanceof HTMLInputElement&&(e.value=this.user.data[t]||"",e.addEventListener("input",(()=>this.onHeaderInputChanged(t,e))))}))}getInputEl(t){return this.headerEl.querySelector(`[name="${t}"]`)}queryUserInfo={timeout:null,abortFunc:null};onHeaderInputChanged(t,e){this.user.data[t]=e.value.trim(),"nick"!==t&&"email"!==t||(this.user.data.token="",this.user.data.isAdmin=!1,null!==this.queryUserInfo.timeout&&window.clearTimeout(this.queryUserInfo.timeout),null!==this.queryUserInfo.abortFunc&&this.queryUserInfo.abortFunc(),this.queryUserInfo.timeout=window.setTimeout((()=>{this.queryUserInfo.timeout=null;const{req:t,abort:e}=new _(this.ctx).userGet(this.user.data.nick,this.user.data.email);this.queryUserInfo.abortFunc=e,t.then((t=>{t.is_login||(this.user.data.token="",this.user.data.isAdmin=!1),this.ctx.dispatchEvent("unread-update",{notifies:t.unread}),this.user.checkHasBasicUserInfo()&&!t.is_login&&t.user&&t.user.is_admin&&this.showLoginDialog(),t.user&&t.user.link&&(this.user.data.link=t.user.link,this.getInputEl("link").value=t.user.link)})).finally((()=>{this.queryUserInfo.abortFunc=null}))}),400)),this.saveUser()}showLoginDialog(){this.ctx.dispatchEvent("checker-admin",{onSuccess:()=>{}})}saveUser(){this.user.save(),this.ctx.dispatchEvent("user-changed")}saveContent(){window.localStorage.setItem("ArtalkContent",this.getContentOriginal().trim())}initTextarea(){this.textareaEl.placeholder=this.ctx.conf.placeholder||"",this.textareaEl.addEventListener("keydown",(t=>{9===(t.keyCode||t.which)&&(t.preventDefault(),this.insertContent("\t"))})),this.textareaEl.addEventListener("input",(t=>{this.adjustTextareaHeight()}))}adjustTextareaHeight(){const t=this.textareaEl.offsetHeight-this.textareaEl.clientHeight;this.textareaEl.style.height="0px",this.textareaEl.style.height=`${this.textareaEl.scrollHeight+t}px`}openedPlugName=null;initEditorPlug(){this.plugList={},this.plugWrapEl.innerHTML="",this.plugWrapEl.style.display="none",this.openedPlugName=null,this.plugSwitcherWrapEl.innerHTML="",this.LOADABLE_PLUG_LIST.forEach((t=>{const e=new t(this);this.plugList[e.getName()]=e;const i=a(`<span class="atk-editor-action atk-editor-plug-switcher">${e.getBtnHtml()}</span>`);this.plugSwitcherWrapEl.appendChild(i),i.addEventListener("click",(()=>{if(this.plugSwitcherWrapEl.querySelectorAll(".active").forEach((t=>t.classList.remove("active"))),e.getName()===this.openedPlugName)return e.onHide(),this.plugWrapEl.style.display="none",void(this.openedPlugName=null);if(null===this.plugWrapEl.querySelector(`[data-plug-name="${e.getName()}"]`)){const t=e.getEl();t.setAttribute("data-plug-name",e.getName()),t.style.display="none",this.plugWrapEl.appendChild(t)}Array.from(this.plugWrapEl.children).forEach((t=>{const i=t.getAttribute("data-plug-name");i===e.getName()?(t.style.display="",this.plugList[i].onShow()):(t.style.display="none",this.plugList[i].onHide())})),this.plugWrapEl.style.display="",this.openedPlugName=e.getName(),i.classList.add("active")}))}))}closePlug(){this.plugWrapEl.innerHTML="",this.plugWrapEl.style.display="none",this.openedPlugName=null}insertContent(t){if(document.selection)this.textareaEl.focus(),document.selection.createRange().text=t,this.textareaEl.focus();else if(this.textareaEl.selectionStart||0===this.textareaEl.selectionStart){const e=this.textareaEl.selectionStart,i=this.textareaEl.selectionEnd,n=this.textareaEl.scrollTop;this.setContent(this.textareaEl.value.substring(0,e)+t+this.textareaEl.value.substring(i,this.textareaEl.value.length)),this.textareaEl.focus(),this.textareaEl.selectionStart=e+t.length,this.textareaEl.selectionEnd=e+t.length,this.textareaEl.scrollTop=n}else this.textareaEl.focus(),this.textareaEl.value+=t}setContent(t){this.textareaEl.value=t,this.saveContent(),this.plugList&&this.plugList.preview&&this.plugList.preview.updateContent(),this.adjustTextareaHeight()}clearEditor(){this.setContent(""),this.cancelReply()}getContent(){let t=this.getContentOriginal();if(this.plugList&&this.plugList.emoticons){t=this.plugList.emoticons.transEmoticonImageText(t)}return t}getContentOriginal(){return this.textareaEl.value||""}getContentMarked(){return h(this.ctx,this.getContent())}initBottomPart(){this.initReply(),this.initSubmit()}initReply(){this.replyComment=null,this.sendReplyEl=null}setReply(t){null!==this.replyComment&&this.cancelReply(),null===this.sendReplyEl&&(this.sendReplyEl=a('<div class="atk-send-reply-wrap"><div class="atk-send-reply">回复 <span class="atk-text"></span><span class="atk-cancel" title="取消 AT">×</span></div></div>'),this.sendReplyEl.querySelector(".atk-text").innerText=`@${t.nick}`,this.sendReplyEl.addEventListener("click",(()=>{this.cancelReply()})),this.textareaWrapEl.prepend(this.sendReplyEl)),this.replyComment=t,k(this.el),this.textareaEl.focus()}cancelReply(){null!==this.sendReplyEl&&(this.sendReplyEl.remove(),this.sendReplyEl=null),this.replyComment=null}initSubmit(){this.submitBtn.innerText=this.ctx.conf.sendBtn||"Send",this.submitBtn.addEventListener("click",(t=>{t.currentTarget,this.submit()}))}async submit(){if(""!==this.getContent().trim()){m(this.el);try{const t=await new _(this.ctx).add({content:this.getContent(),nick:this.user.data.nick,email:this.user.data.email,link:this.user.data.link,rid:null===this.replyComment?0:this.replyComment.id});this.ctx.dispatchEvent("list-insert",t),this.clearEditor()}catch(t){this.showNotify(`评论失败，${t.msg||String(t)}`,"e")}finally{g(this.el)}}else this.textareaEl.focus()}showNotify(t,e){y(this.notifyWrapEl,t,e)}closeComment(){this.closeCommentEl.style.display="",this.user.data.isAdmin?(this.textareaEl.style.display="",this.bottomEl.style.display=""):(this.textareaEl.style.display="none",this.closePlug(),this.bottomEl.style.display="none")}openComment(){this.closeCommentEl.style.display="none",this.textareaEl.style.display="",this.bottomEl.style.display=""}}var U=window||{},P=navigator||{};function I(t){var e=t||P.userAgent,i=this,n={Trident:e.indexOf("Trident")>-1||e.indexOf("NET CLR")>-1,Presto:e.indexOf("Presto")>-1,WebKit:e.indexOf("AppleWebKit")>-1,Gecko:e.indexOf("Gecko/")>-1,Safari:e.indexOf("Safari")>-1,Chrome:e.indexOf("Chrome")>-1||e.indexOf("CriOS")>-1,IE:e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1,Edge:e.indexOf("Edge")>-1,Firefox:e.indexOf("Firefox")>-1||e.indexOf("FxiOS")>-1,"Firefox Focus":e.indexOf("Focus")>-1,Chromium:e.indexOf("Chromium")>-1,Opera:e.indexOf("Opera")>-1||e.indexOf("OPR")>-1,Vivaldi:e.indexOf("Vivaldi")>-1,Yandex:e.indexOf("YaBrowser")>-1,Kindle:e.indexOf("Kindle")>-1||e.indexOf("Silk/")>-1,360:e.indexOf("360EE")>-1||e.indexOf("360SE")>-1,UC:e.indexOf("UC")>-1||e.indexOf(" UBrowser")>-1,QQBrowser:e.indexOf("QQBrowser")>-1,QQ:e.indexOf("QQ/")>-1,Baidu:e.indexOf("Baidu")>-1||e.indexOf("BIDUBrowser")>-1,Maxthon:e.indexOf("Maxthon")>-1,Sogou:e.indexOf("MetaSr")>-1||e.indexOf("Sogou")>-1,LBBROWSER:e.indexOf("LBBROWSER")>-1,"2345Explorer":e.indexOf("2345Explorer")>-1,TheWorld:e.indexOf("TheWorld")>-1,XiaoMi:e.indexOf("MiuiBrowser")>-1,Quark:e.indexOf("Quark")>-1,Qiyu:e.indexOf("Qiyu")>-1,Wechat:e.indexOf("MicroMessenger")>-1,Taobao:e.indexOf("AliApp(TB")>-1,Alipay:e.indexOf("AliApp(AP")>-1,Weibo:e.indexOf("Weibo")>-1,Douban:e.indexOf("com.douban.frodo")>-1,Suning:e.indexOf("SNEBUY-APP")>-1,iQiYi:e.indexOf("IqiyiApp")>-1,Windows:e.indexOf("Windows")>-1,Linux:e.indexOf("Linux")>-1||e.indexOf("X11")>-1,"Mac OS":e.indexOf("Macintosh")>-1,Android:e.indexOf("Android")>-1||e.indexOf("Adr")>-1,Ubuntu:e.indexOf("Ubuntu")>-1,FreeBSD:e.indexOf("FreeBSD")>-1,Debian:e.indexOf("Debian")>-1,"Windows Phone":e.indexOf("IEMobile")>-1||e.indexOf("Windows Phone")>-1,BlackBerry:e.indexOf("BlackBerry")>-1||e.indexOf("RIM")>-1,MeeGo:e.indexOf("MeeGo")>-1,Symbian:e.indexOf("Symbian")>-1,iOS:e.indexOf("like Mac OS X")>-1,"Chrome OS":e.indexOf("CrOS")>-1,WebOS:e.indexOf("hpwOS")>-1,Mobile:e.indexOf("Mobi")>-1||e.indexOf("iPh")>-1||e.indexOf("480")>-1,Tablet:e.indexOf("Tablet")>-1||e.indexOf("Pad")>-1||e.indexOf("Nexus 7")>-1};n.Mobile?n.Mobile=!(e.indexOf("iPad")>-1):U.showModalDialog&&U.chrome&&(n[360]=!0);var s,a={engine:["WebKit","Trident","Gecko","Presto"],browser:["Safari","Chrome","Edge","IE","Firefox","Firefox Focus","Chromium","Opera","Vivaldi","Yandex","Kindle","360","UC","QQBrowser","QQ","Baidu","Maxthon","Sogou","LBBROWSER","2345Explorer","TheWorld","XiaoMi","Quark","Qiyu","Wechat","Taobao","Alipay","Weibo","Douban","Suning","iQiYi"],os:["Windows","Linux","Mac OS","Android","Ubuntu","FreeBSD","Debian","iOS","Windows Phone","BlackBerry","MeeGo","Symbian","Chrome OS","WebOS"],device:["Mobile","Tablet"]};for(var r in i.device="PC",i.language=((s=(P.browserLanguage||P.language).split("-"))[1]&&(s[1]=s[1].toUpperCase()),s.join("_")),a)for(var o=0;o<a[r].length;o++){var l=a[r][o];n[l]&&(i[r]=l)}var c={Windows:function(){var t=e.replace(/^.*Windows NT ([\d.]+);.*$/,"$1");return{6.4:"10",6.3:"8.1",6.2:"8",6.1:"7","6.0":"Vista",5.2:"XP",5.1:"XP","5.0":"2000"}[t]||t},Android:function(){return e.replace(/^.*Android ([\d.]+);.*$/,"$1")},iOS:function(){return e.replace(/^.*OS ([\d_]+) like.*$/,"$1").replace(/_/g,".")},Debian:function(){return e.replace(/^.*Debian\/([\d.]+).*$/,"$1")},"Windows Phone":function(){return e.replace(/^.*Windows Phone( OS)? ([\d.]+);.*$/,"$2")},"Mac OS":function(){return e.replace(/^.*Mac OS X ([\d_]+).*$/,"$1").replace(/_/g,".")},WebOS:function(){return e.replace(/^.*hpwOS\/([\d.]+);.*$/,"$1")}};i.osVersion="",c[i.os]&&(i.osVersion=c[i.os](),i.osVersion===e&&(i.osVersion=""));var d={Safari:function(){return e.replace(/^.*Version\/([\d.]+).*$/,"$1")},Chrome:function(){return e.replace(/^.*Chrome\/([\d.]+).*$/,"$1").replace(/^.*CriOS\/([\d.]+).*$/,"$1")},IE:function(){return e.replace(/^.*MSIE ([\d.]+).*$/,"$1").replace(/^.*rv:([\d.]+).*$/,"$1")},Edge:function(){return e.replace(/^.*Edge\/([\d.]+).*$/,"$1")},Firefox:function(){return e.replace(/^.*Firefox\/([\d.]+).*$/,"$1").replace(/^.*FxiOS\/([\d.]+).*$/,"$1")},"Firefox Focus":function(){return e.replace(/^.*Focus\/([\d.]+).*$/,"$1")},Chromium:function(){return e.replace(/^.*Chromium\/([\d.]+).*$/,"$1")},Opera:function(){return e.replace(/^.*Opera\/([\d.]+).*$/,"$1").replace(/^.*OPR\/([\d.]+).*$/,"$1")},Vivaldi:function(){return e.replace(/^.*Vivaldi\/([\d.]+).*$/,"$1")},Yandex:function(){return e.replace(/^.*YaBrowser\/([\d.]+).*$/,"$1")},Kindle:function(){return e.replace(/^.*Version\/([\d.]+).*$/,"$1")},Maxthon:function(){return e.replace(/^.*Maxthon\/([\d.]+).*$/,"$1")},QQBrowser:function(){return e.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1")},QQ:function(){return e.replace(/^.*QQ\/([\d.]+).*$/,"$1")},Baidu:function(){return e.replace(/^.*BIDUBrowser[\s/]([\d.]+).*$/,"$1")},UC:function(){return e.replace(/^.*UC?Browser\/([\d.]+).*$/,"$1")},Sogou:function(){return e.replace(/^.*SE ([\d.X]+).*$/,"$1").replace(/^.*SogouMobileBrowser\/([\d.]+).*$/,"$1")},"2345Explorer":function(){return e.replace(/^.*2345Explorer\/([\d.]+).*$/,"$1")},TheWorld:function(){return e.replace(/^.*TheWorld ([\d.]+).*$/,"$1")},XiaoMi:function(){return e.replace(/^.*MiuiBrowser\/([\d.]+).*$/,"$1")},Quark:function(){return e.replace(/^.*Quark\/([\d.]+).*$/,"$1")},Qiyu:function(){return e.replace(/^.*Qiyu\/([\d.]+).*$/,"$1")},Wechat:function(){return e.replace(/^.*MicroMessenger\/([\d.]+).*$/,"$1")},Taobao:function(){return e.replace(/^.*AliApp\(TB\/([\d.]+).*$/,"$1")},Alipay:function(){return e.replace(/^.*AliApp\(AP\/([\d.]+).*$/,"$1")},Weibo:function(){return e.replace(/^.*weibo__([\d.]+).*$/,"$1")},Douban:function(){return e.replace(/^.*com.douban.frodo\/([\d.]+).*$/,"$1")},Suning:function(){return e.replace(/^.*SNEBUY-APP([\d.]+).*$/,"$1")},iQiYi:function(){return e.replace(/^.*IqiyiVersion\/([\d.]+).*$/,"$1")}};i.version="",d[i.browser]&&(i.version=d[i.browser](),i.version===e&&(i.version="")),i.version.indexOf(".")&&(i.version=i.version.substring(0,i.version.indexOf("."))),"Edge"===i.browser?i.engine="EdgeHTML":"Chrome"===i.browser&&parseInt(i.version)>27||"Opera"===i.browser&&parseInt(i.version)>12||"Yandex"===i.browser?i.engine="Blink":void 0===i.browser&&(i.browser="Unknow App")}function H(t){return new I(t)}class W extends E{data;mainEl;bodyEl;contentEl;childrenEl;actionsEl;parent;nestedNum;maxNestingNum=3;children=[];replyTo;afterRender;unread=!1;openable=!1;openURL;openEvt;constructor(t,e){super(t),this.data={...e},this.data.date=this.data.date.replace(/-/g,"/"),this.parent=null,this.nestedNum=1}renderElem(){this.el=a('<div class="atk-comment-wrap" data-comment-id="">\n  <div class="atk-comment">\n\n    <div class="atk-avatar">\n      <a target="_blank"><img src=""></a>\n    </div>\n\n    <div class="atk-comment-main">\n\n      <div class="atk-header">\n        <span class="atk-nick"><a target="_blank"></a></span>\n        <span class="atk-badge"></span>\n        <span class="atk-date"></span>\n        <span class="atk-ua ua-browser"></span>\n        <span class="atk-ua ua-os"></span>\n      </div>\n\n      <div class="atk-body">\n        <div class="atk-content"></div>\n      </div>\n\n      <div class="atk-footer">\n        <div class="atk-comment-actions"></div>\n      </div>\n\n    </div>\n\n  </div>\n</div>\n'),this.mainEl=this.el.querySelector(".atk-comment-main"),this.bodyEl=this.el.querySelector(".atk-body"),this.contentEl=this.bodyEl.querySelector(".atk-content"),this.actionsEl=this.el.querySelector(".atk-comment-actions"),this.childrenEl=null,this.unread?this.el.classList.add("atk-unread"):this.el.classList.remove("atk-unread"),this.openable?this.el.classList.add("atk-openable"):this.el.classList.remove("atk-openable"),this.el.addEventListener("click",(t=>{this.openable&&this.openURL&&(t.preventDefault(),window.open(this.openURL)),this.openEvt&&this.openEvt()})),this.el.setAttribute("data-comment-id",`${this.data.id}`),this.el.querySelector(".atk-avatar a").setAttribute("href",this.data.link),this.el.querySelector(".atk-avatar img").setAttribute("src",this.getGravatarUrl());const t=this.el.querySelector(".atk-nick > a");t.innerText=this.data.nick,t.href=this.data.link;const e=this.el.querySelector(".atk-badge");this.data.badge_name?(e.innerText=this.data.badge_name,this.data.badge_color&&(e.style.backgroundColor=this.data.badge_color)):e.remove();const i=this.el.querySelector(".atk-date");if(i.innerText=this.getDateFormatted(),i.setAttribute("data-atk-comment-date",String(+new Date(this.data.date))),this.el.querySelector(".atk-ua.ua-browser").innerText=this.getUserUaBrowser(),this.el.querySelector(".atk-ua.ua-os").innerText=this.getUserUaOS(),this.data.is_collapsed){this.contentEl.classList.add("atk-hide","atk-type-collapsed");const t=a('\n      <div class="atk-collapsed">\n        <span class="atk-text">该评论已被系统或管理员折叠</span>\n        <span class="atk-show-btn">查看内容</span>\n      </div>');this.bodyEl.insertAdjacentElement("beforeend",t);const e=t.querySelector(".atk-show-btn");e.addEventListener("click",(t=>{this.contentEl.classList.contains("atk-hide")?(this.contentEl.innerHTML=this.getContentMarked(),this.contentEl.classList.remove("atk-hide"),x(this.contentEl),e.innerHTML="收起内容"):(this.contentEl.innerHTML="",this.contentEl.classList.add("atk-hide"),e.innerHTML="查看内容"),t.stopPropagation()}))}else this.contentEl.innerHTML=this.getContentMarked();if(this.replyTo){const t=a('\n      <div class="atk-reply-to">\n        <div class="atk-meta">回复 <span class="atk-nick"></span>:</div>\n        <div class="atk-content"></div>\n      </div>');t.querySelector(".atk-nick").innerText=`@${this.replyTo.nick}`,t.querySelector(".atk-content").innerHTML=h(this.ctx,this.replyTo.content),this.bodyEl.prepend(t)}if(this.data.is_pending){const t=a('<div class="atk-pending">审核中，仅本人可见。</div>');this.bodyEl.prepend(t)}return this.initActionBtn(),this.afterRender&&this.afterRender(),this.el}eachComment(t,e){0!==t.length&&t.every((i=>!1!==e(i,t)&&(this.eachComment(i.getChildren(),e),!0)))}refreshUI(){const t=this.el,e=this.renderElem();t.replaceWith(e),this.playFadeInAnim(),this.eachComment(this.children,(t=>{t.parent?.getChildrenEl().appendChild(t.renderElem()),t.playFadeInAnim()}))}initActionBtn(){const t=a("<span></span>"),e=a("<span></span>");this.actionsEl.append(t),this.actionsEl.append(e);const i=()=>{t.innerText=`赞同 (${this.data.vote_up||0})`,e.innerText=`反对 (${this.data.vote_down||0})`};if(i(),t.onclick=()=>{new _(this.ctx).vote(this.data.id,"comment_up").then((t=>{this.data.vote_up=t,i()})).catch((t=>{window.alert(`投票失败：${t.msg||String(t)}`)}))},e.onclick=()=>{new _(this.ctx).vote(this.data.id,"comment_down").then((t=>{this.data.vote_down=t,i()})).catch((t=>{window.alert(`投票失败：${t.msg||String(t)}`)}))},this.data.is_allow_reply){const t=a('<span data-atk-action="comment-reply">回复</span>');this.actionsEl.append(t),t.addEventListener("click",(t=>{this.ctx.dispatchEvent("editor-reply",this.data),t.stopPropagation()}))}const n=a(`<span atk-only-admin-show>${this.data.is_collapsed?"取消折叠":"折叠"}</span>`);this.actionsEl.append(n),n.addEventListener("click",(t=>{this.adminEdit("collapsed",n),t.stopPropagation()}));const s=a(`<span atk-only-admin-show>${this.data.is_pending?"待审":"已审"}</span>`);this.actionsEl.append(s),s.addEventListener("click",(t=>{this.adminEdit("pending",s),t.stopPropagation()}));const r=a("<span atk-only-admin-show>删除</span>");this.actionsEl.append(r),r.addEventListener("click",(t=>{this.adminDelete(r),t.stopPropagation()}))}getIsRoot(){return null===this.parent}getChildren(){return this.children}putChild(t){t.parent=this,t.nestedNum=this.nestedNum+1,this.children.push(t),this.getChildrenEl().appendChild(t.getEl()),t.playFadeInAnim()}getChildrenEl(){return null===this.childrenEl&&(this.nestedNum<this.maxNestingNum?(this.childrenEl=a('<div class="atk-comment-children"></div>'),this.mainEl.appendChild(this.childrenEl)):this.parent&&(this.childrenEl=this.parent.getChildrenEl())),this.childrenEl}getParent(){return this.parent}getEl(){return this.el}getData(){return this.data}getGravatarUrl(){return`${this.ctx.conf.gravatar?.cdn||""}${this.data.email_encrypted}?d=${encodeURIComponent(this.ctx.conf.defaultAvatar||"")}&s=80`}getContentMarked(){return h(this.ctx,this.data.content)}getDateFormatted(){return c(new Date(this.data.date))}getUserUaBrowser(){const t=H(this.data.ua);return`${t.browser} ${t.version}`}getUserUaOS(){const t=H(this.data.ua);return`${t.os} ${t.osVersion}`}playFadeInAnim(){x(this.el)}adminEdit(t,e){if(e.classList.contains("atk-in-process"))return;const i=e.innerText;e.classList.add("atk-in-process"),e.innerText="修改中...","collapsed"===t?this.data.is_collapsed=!this.data.is_collapsed:"pending"===t&&(this.data.is_pending=!this.data.is_pending),new _(this.ctx).commentEdit(this.data).then((t=>{e.classList.remove("atk-in-process"),this.data=t,this.refreshUI(),x(this.bodyEl),this.ctx.dispatchEvent("list-refresh-ui")})).catch((t=>{console.error(t),e.classList.add("atk-error"),e.innerText="修改失败",setTimeout((()=>{e.innerText=i,e.classList.remove("atk-error"),e.classList.remove("atk-in-process")}),2e3)}))}onDelete;adminDelete(t){if(t.classList.contains("atk-in-process"))return;const e=Number(t.getAttribute("data-btn-clicked")||1);if(e<2){if(1===e){const i=t.innerText;t.innerText="确认删除",setTimeout((()=>{t.innerText=i,t.setAttribute("data-btn-clicked","")}),2e3),t.setAttribute("data-btn-clicked",String(e+1))}return}const i=t.innerText;t.classList.add("atk-in-process"),t.innerText="删除中...",new _(this.ctx).commentDel(this.data.id,this.data.site_name).then((()=>{t.innerText=i,t.classList.remove("atk-in-process"),this.onDelete&&this.onDelete(this)})).catch((e=>{console.error(e),t.classList.add("atk-error"),t.innerText="删除失败",setTimeout((()=>{t.innerText=i,t.classList.remove("atk-error"),t.classList.remove("atk-in-process")}),2e3)}))}setUnread(t){this.unread=t,this.unread?this.el.classList.add("atk-unread"):this.el.classList.remove("atk-unread")}setOpenURL(t){t||(this.openable=!1,this.el.classList.remove("atk-openable")),this.openable=!0,this.openURL=t,this.el.classList.add("atk-openable")}}class F extends E{el;commentsWrapEl;comments=[];data;pageSize=15;offset=0;type;readMoreEl;readMoreLoadingEl;readMoreTextEl;noCommentText;renderComment;paramsEditor;onAfterLoad;isLoading=!1;isFirstLoad=!0;flatMode=!1;unread=[];unreadHighlight=!1;constructor(t){super(t),this.el=a('\n    <div class="atk-list-lite">\n      <div class="atk-list-comments-wrap"></div>\n      <div class="atk-list-read-more" style="display: none;">\n        <div class="atk-loading-icon" style="display: none;"></div>\n        <span class="atk-text">查看更多</span>\n      </div>\n    </div>\n    '),this.commentsWrapEl=this.el.querySelector(".atk-list-comments-wrap"),this.pageSize=this.conf.readMore&&this.conf.readMore.pageSize||this.pageSize,this.readMoreEl=this.el.querySelector(".atk-list-read-more"),this.readMoreLoadingEl=this.readMoreEl.querySelector(".atk-loading-icon"),this.readMoreTextEl=this.readMoreEl.querySelector(".atk-text"),this.readMoreEl.addEventListener("click",(()=>{this.readMore()})),this.noCommentText=this.conf.noComment||"无评论",setInterval((()=>{this.el.querySelectorAll("[data-atk-comment-date]").forEach((t=>{const e=t.getAttribute("data-atk-comment-date");t.innerText=c(new Date(Number(e)))}))}),3e4),this.ctx.addEventListener("unread-update",(t=>this.updateUnread(t.notifies)))}async reqComments(t=0){0===t&&this.clearComments(),this.isLoading=!0,0===t?m(this.el):this.readMoreBtnSetLoading(!0);const e=()=>{this.isLoading=!1,0===t?g(this.el):this.readMoreBtnSetLoading(!1)};let i;try{i=await new _(this.ctx).get(t,this.type,this.paramsEditor)}catch(n){throw this.onError(n.msg||String(n)),n}finally{e()}this.offset=t;try{this.onLoad(i),this.onAfterLoad&&this.onAfterLoad(i)}catch(n){throw this.onError(String(n)),n}finally{e()}}onLoad(t){this.data=t,v(this.el,null),this.importComments(t.comments),this.hasMoreComments?this.showReadMoreBtn():this.hideReadMoreBtn(),this.isFirstLoad&&this.hasMoreComments&&this.initScrollBottomAutoLoad(),this.ctx.dispatchEvent("unread-update",{notifies:t.unread||[]}),this.isFirstLoad=!1}onError(t){if(t=String(t),console.error(t),this.isFirstLoad){const e=a(`<span>${t}，无法获取评论列表数据<br/></span>`),i=a('<span style="cursor:pointer;">点击重新获取</span>');i.onclick=()=>{this.reqComments(0)},e.appendChild(i);const n=a('<span atk-only-admin-show> | <span style="cursor:pointer;">打开控制台</span></span>');n.onclick=()=>{this.ctx.dispatchEvent("sidebar-show",{viewName:"admin"})},this.ctx.user.data.isAdmin||n.classList.add("atk-hide"),e.appendChild(n),v(this.el,e)}else this.readMoreBtnShowErr(`${t} 获取失败`)}createComment(t){const e=new W(this.ctx,t);return e.afterRender=()=>{this.renderComment&&this.renderComment(e)},e.onDelete=t=>{this.deleteComment(t),this.refreshUI()},e}importComments(t){const e=i=>{const n=t.filter((t=>t.rid===i.data.id));0!==n.length&&n.forEach((t=>{t.is_allow_reply=i.data.is_allow_reply;const n=this.createComment(t);n.renderElem(),i.putChild(n),e(n)}))};this.flatMode?t.forEach((e=>{e.is_collapsed&&(e.is_allow_reply=!1);const i=this.createComment(e);if(0!==e.rid){const n=t.find((t=>t.id===e.rid));n&&(i.replyTo=n)}i.renderElem(),this.comments.push(i),e.visible&&(this.commentsWrapEl.appendChild(i.getEl()),i.playFadeInAnim())})):t.filter((t=>0===t.rid)).forEach((t=>{t.is_collapsed&&(t.is_allow_reply=!1);const i=this.createComment(t);i.renderElem(),this.comments.push(i),this.commentsWrapEl.appendChild(i.getEl()),i.playFadeInAnim(),e(i)})),this.refreshUI()}insertComment(t){const e=this.createComment(t);e.renderElem(),0!==t.rid?this.findComment(t.rid)?.putChild(e):(this.commentsWrapEl.prepend(e.getEl()),this.comments.unshift(e)),k(e.getEl()),e.playFadeInAnim(),this.data&&(this.data.total+=1),this.refreshUI()}refreshUI(){const t=this.comments.length<=0;let e=this.commentsWrapEl.querySelector(".atk-list-no-comment");t&&(e||(e=a('<div class="atk-list-no-comment"></div>'),this.commentsWrapEl.appendChild(e),e.innerHTML=this.noCommentText)),!t&&e&&e.remove(),this.ctx.dispatchEvent("check-admin-show-el")}getListCommentCount(){return this.data&&this.data.total?Number(this.data.total||"0"):0}get hasMoreComments(){return!!this.data&&this.data.total_parents>this.offset+this.pageSize}async readMore(){const t=this.offset+this.pageSize;await this.reqComments(t)}showReadMoreBtn(){this.readMoreEl.style.display=""}hideReadMoreBtn(){this.readMoreEl.style.display="none"}readMoreBtnSetLoading(t){this.readMoreLoadingEl.style.display=t?"":"none",this.readMoreTextEl.style.display=t?"none":""}readMoreBtnShowErr(t){this.readMoreBtnSetLoading(!1);const e=this.readMoreTextEl.innerText;this.readMoreTextEl.innerText=t,this.readMoreEl.classList.add("atk-err"),setTimeout((()=>{this.readMoreTextEl.innerText=e,this.readMoreEl.classList.remove("atk-err")}),2e3)}initScrollBottomAutoLoad(){this.conf.readMore&&this.conf.readMore.autoLoad&&document.addEventListener("scroll",(()=>{const t=this.el.querySelector(".atk-list-comments-wrap > .atk-comment-wrap:nth-last-child(3)");t&&this.hasMoreComments&&(this.isLoading||f(t)&&this.readMore())}))}eachComment(t,e){0!==t.length&&t.every((i=>!1!==e(i,t)&&(this.eachComment(i.getChildren(),e),!0)))}findComment(t,e){e||(e=this.comments);let i=null;return this.eachComment(e,(e=>e.data.id!==t||(i=e,!1))),i}getCommentCount(){let t=0;return this.eachComment(this.comments,(()=>{t++})),t}deleteComment(t){let e;if("number"==typeof t){if(e=this.findComment(t),!e)throw Error(`未找到评论 ${t}`)}else e=t;e.getEl().remove(),this.eachComment(this.comments,((t,i)=>t!==e||(i.splice(i.indexOf(t),1),!1)))}clearComments(){this.commentsWrapEl.innerHTML="",this.data=void 0,this.comments=[]}updateUnread(t){this.unread=t,this.unreadHighlight&&this.eachComment(this.comments,(t=>{const e=this.unread.find((e=>e.comment_id===t.data.id));e?(t.setUnread(!0),t.setOpenURL(e.read_link),t.openEvt=()=>{this.unread=this.unread.filter((e=>e.comment_id!==t.data.id)),this.ctx.dispatchEvent("unread-update",{notifies:this.unread})}):t.setUnread(!1)}))}}class N extends F{closeCommentBtnEl;openSidebarBtnEl;openAdminPanelBtnEl;unreadBadgeEl;constructor(t){super(t);const e=a('<div class="atk-list">\n  <div class="atk-list-header">\n    <div class="atk-comment-count">\n      <span class="atk-comment-count-num">0</span>\n      条评论\n    </div>\n    <div class="atk-right-action">\n      <span data-action="admin-close-comment" class="atk-hide" atk-only-admin-show>关闭评论</span>\n      <span data-action="open-admin-panel" class="atk-hide atk-on" atk-only-admin-show>控制台</span>\n      <span data-action="open-sidebar" class="atk-hide atk-on">\n        <span class="atk-unread-badge" style="display: none;"></span>\n        通知中心\n      </span>\n    </div>\n  </div>\n  <div class="atk-list-body"></div>\n  <div class="atk-list-footer">\n    <div class="atk-copyright"></div>\n  </div>\n</div>\n');e.querySelector(".atk-list-body").append(this.el),this.el=e,this.initListActionBtn(),this.el.querySelector(".atk-copyright").innerHTML='Powered By <a href="https://artalk.js.org" target="_blank" title="Artalk v2.0.0">Artalk</a>',this.ctx.addEventListener("list-reload",(()=>this.reqComments(0))),this.ctx.addEventListener("list-clear",(()=>this.clearComments())),this.ctx.addEventListener("list-refresh-ui",(()=>this.refreshUI())),this.ctx.addEventListener("list-import",(t=>this.importComments(t))),this.ctx.addEventListener("list-insert",(t=>this.insertComment(t))),this.ctx.addEventListener("list-comment-del",(t=>this.deleteComment(t.id))),this.ctx.addEventListener("list-update-data",(t=>{t(this.data),this.refreshUI()})),this.ctx.addEventListener("unread-update",(t=>this.showUnreadBadge(t.notifies?.length||0)))}refreshUI(){super.refreshUI(),this.el.querySelector(".atk-comment-count-num").innerText=String(this.getListCommentCount()),this.ctx.user.data.nick&&this.ctx.user.data.email?this.openSidebarBtnEl.classList.remove("atk-hide"):this.openSidebarBtnEl.classList.add("atk-hide"),this.ctx.dispatchEvent("check-admin-show-el"),this.data&&this.data.page&&!0===this.data.page.admin_only?(this.ctx.dispatchEvent("editor-close-comment"),this.closeCommentBtnEl.innerHTML="打开评论"):(this.ctx.dispatchEvent("editor-open-comment"),this.closeCommentBtnEl.innerHTML="关闭评论")}onLoad(t){super.onLoad(t),this.checkGoToCommentByUrlHash()}async checkGoToCommentByUrlHash(){let t=Number(r("atk_comment"));if(!t){const e=window.location.hash.match(/#atk-comment-([0-9]+)/);if(!e||!e[1]||Number.isNaN(Number(e[1])))return;t=Number(e[1])}if(!t)return;const e=this.findComment(t);e||this.hasMoreComments&&await this.readMore(),e&&(k(e.getEl(),!1),setTimeout((()=>{e.getEl().classList.add("atk-flash-once");const t=r("atk_notify_key");t&&new _(this.ctx).markRead(t).then((()=>{this.unread=this.unread.filter((t=>t.comment_id!==e.data.id)),this.ctx.dispatchEvent("unread-update",{notifies:this.unread})}))}),800))}initListActionBtn(){this.openSidebarBtnEl=this.el.querySelector('[data-action="open-sidebar"]'),this.openSidebarBtnEl.addEventListener("click",(()=>{this.ctx.dispatchEvent("sidebar-show",{viewName:"message"})})),this.openAdminPanelBtnEl=this.el.querySelector('[data-action="open-admin-panel"]'),this.openAdminPanelBtnEl.addEventListener("click",(()=>{this.ctx.dispatchEvent("sidebar-show",{viewName:"admin"})})),this.closeCommentBtnEl=this.el.querySelector('[data-action="admin-close-comment"]'),this.closeCommentBtnEl.addEventListener("click",(()=>{this.data&&(this.data.page.admin_only=!this.data.page.admin_only,this.adminPageEditSave())})),this.unreadBadgeEl=this.el.querySelector(".atk-unread-badge")}adminPageEditSave(){this.data&&this.data.page&&(this.ctx.dispatchEvent("editor-show-loading"),new _(this.ctx).pageEdit(this.data.page).then((t=>{this.data&&(this.data.page={...t}),this.refreshUI()})).catch((t=>{this.ctx.dispatchEvent("editor-notify",{msg:`修改页面数据失败：${t.msg||String(t)}`,type:"e"})})).finally((()=>{this.ctx.dispatchEvent("editor-hide-loading")})))}showUnreadBadge(t){t>0?(this.unreadBadgeEl.innerText=`${Number(t||0)}`,this.unreadBadgeEl.style.display="block"):this.unreadBadgeEl.style.display="none"}}class j extends E{constructor(t){super(t),this.el=a('<div class="atk-sidebar-view"></div>')}name="";title=this.name;actions={};activeAction;adminOnly=!1;init(){}switch(t){}}class D extends j{name="message";title="通知中心";actions={mentions:"提及",all:"全部",mine:"我的",pending:"待审"};activeAction="";list;type="mentions";init(){this.list=z(this.ctx),this.el.innerHTML="",this.el.append(this.list.el),this.activeAction=this.type,this.switch(this.type)}switch(t){this.list&&(this.type=t,this.list.type=t,this.list.isFirstLoad=!0,this.list.reqComments())}}function z(t){const e=new F(t);return e.flatMode=!0,e.unreadHighlight=!0,e.noCommentText='<div class="atk-sidebar-no-content">无内容</div>',e.renderComment=t=>{t.setOpenURL(`${t.data.page_key}#atk-comment-${t.data.id}`)},e}class Q extends j{name="admin";title="控制台";actions={comment:"评论",page:"页面",site:"站点",setting:"配置"};activeAction="";adminOnly=!0;cListInstance;get cList(){return this.cListInstance||(this.cListInstance=z(this.ctx)),this.cListInstance}constructor(t){super(t),this.el=a('<div class="atk-msg-center"></div>')}init(){this.activeAction="comment",this.switch("comment")}switch(t){this.el.innerHTML="","comment"===t?this.initCommentList():"page"===t?this.initPageList():"site"===t?this.initSiteList():"setting"===t&&this.initSetting()}async initSiteFilterBar(t){const e=await new _(this.ctx).siteGet(),i=[{name:"__ATK_SITE_ALL",label:"全部站点"}];e&&e.forEach((t=>{i.push({name:t.name,label:t.name})}));return V(i,(e=>t(e)))}async initCommentList(){const t=a('<div class="atk-admin-comment-list"></div>');t.append(this.cList.el);const e=(t,e)=>{this.cList&&(this.cList.type=`admin_${t}`,this.cList.isFirstLoad=!0,this.cList.paramsEditor=t=>{t.site_name=e},this.cList.reqComments())};let i=!1;const n={typeName:"all",siteName:""},s=V([{name:"all",label:"全部"},{name:"pending",label:"待审"}],(t=>{i&&(n.typeName=t.name,e(n.typeName,n.siteName))}));t.prepend(s);const r=await this.initSiteFilterBar((t=>{n.siteName=t.name,e(n.typeName,n.siteName)}));t.prepend(r),i=!0,this.el.innerHTML="",this.el.append(t)}async initPageList(){const t=a('<div class="atk-admin-page-list"></div>'),e=a('<div class="atk-sidebar-list"></div>');t.append(e);const i=await this.initSiteFilterBar((t=>{this.reqPages(e,t.name)}));t.prepend(i),this.el.innerHTML="",this.el.append(t)}async reqPages(t,e){t.innerHTML="";const i=await new _(this.ctx).pageGet(e);i?i.forEach((i=>{const n=a('\n      <div class="atk-item">\n      <div class="atk-title"></div>\n      <div class="atk-sub"></div>\n      <div class="atk-actions">\n        <div class="atk-item" data-action="page-edit-title">修改标题</div>\n        <div class="atk-item" data-action="page-fetch">获取标题</div>\n        <div class="atk-item" data-action="page-edit-key">修改 KEY</div>\n        <div class="atk-item" data-action="page-admin-only"></div>\n        <div class="atk-item" data-action="page-del">删除</div>\n      </div>\n      </div>');t.append(n),n.setAttribute("data-page-id",String(i.id));const s=n.querySelector(".atk-title"),r=n.querySelector(".atk-sub");s.innerText=i.title||i.key,r.innerText=i.key,s.onclick=()=>{window.open(`${i.url}`)},r.onclick=()=>{window.open(`${i.url}`)};const o=n.querySelector('[data-action="page-admin-only"]'),l=()=>{o.innerText=i.admin_only?"仅管理员可评":"所有人可评"};l(),o.onclick=t=>{t.stopPropagation(),i.admin_only=!i.admin_only,new _(this.ctx).pageEdit(i).then((t=>{i=t,l()}))};n.querySelector('[data-action="page-edit-title"]').onclick=()=>{const n=window.prompt("修改标题：",i.title);null!==n&&(i.title=n,new _(this.ctx).pageEdit(i).then((()=>{this.reqPages(t,e)})).catch((t=>{window.alert(`修改失败：${t.msg||"未知错误"}`)})))};const c=n.querySelector('[data-action="page-fetch"]');c.onclick=()=>{const t=c.innerText;c.innerText="获取中...",new _(this.ctx).pageFetch(i.id).then((t=>{i=t,n.querySelector(".atk-title").innerText=t.title})).catch((t=>{window.alert(`获取失败：${t.msg||"未知错误"}`)})).finally((()=>{c.innerText=t}))};n.querySelector('[data-action="page-edit-key"]').onclick=()=>{const n=window.prompt("修改 Key：",i.key);null!==n&&(i.key=n,new _(this.ctx).pageEdit(i).then((()=>{this.reqPages(t,e)})).catch((t=>{window.alert(`修改失败：${t.msg||"未知错误"}`)})))};n.querySelector('[data-action="page-del"]').onclick=()=>{window.confirm(`确认删除页面 "${i.title||i.key}"？将会删除所有相关数据`)&&(()=>{new _(this.ctx).pageDel(i.key,i.site_name).then((t=>{t&&n.remove()}))})()}})):t.innerHTML='<div class="atk-sidebar-no-content">无内容</div>'}async initSiteList(){const t=a('<div class="atk-site-list"></div>'),e=a('\n    <div class="atk-sidebar-list">\n      <div class="atk-site-add atk-form-inline-wrap">\n        <input type="text" name="siteAdd_name" placeholder="Name..." />\n        <input type="text" name="siteAdd_urls" placeholder="URL..." />\n        <button name="siteAdd_submit">Add</button>\n      </div>\n    </div>\n    ');t.append(e);const i=e.querySelector('[name="siteAdd_name"]'),n=e.querySelector('[name="siteAdd_urls"]');e.querySelector('[name="siteAdd_submit"]').onclick=()=>{const t=i.value.trim(),e=n.value.trim();""!==t?new _(this.ctx).siteAdd(t,e).then((()=>{this.initSiteList()})).catch((t=>{window.alert(`创建失败：${t.msg||""}`)})):i.focus()};const s=await new _(this.ctx).siteGet();s?(s.forEach((t=>{const i=a('\n      <div class="atk-item">\n      <div class="atk-title"></div>\n      <div class="atk-sub"></div>\n      <div class="atk-actions">\n        <div class="atk-item" data-action="site-rename">重命名</div>\n        <div class="atk-item" data-action="site-edit-urls">修改 URL</div>\n        <div class="atk-item" data-action="site-del">删除</div>\n      </div>\n      </div>');e.append(i),i.setAttribute("data-site-id",String(t.id));const n=i.querySelector(".atk-title"),s=i.querySelector(".atk-sub");n.innerText=t.name||t.first_url,n.onclick=()=>{window.open(`${t.first_url}`)},t.urls&&t.urls.forEach((t=>{const e=a('<span style="margin-right: 10px;" />');e.innerText=t,e.onclick=()=>{window.open(`${t}`)},s.append(e)}));i.querySelector('[data-action="site-del"]').onclick=()=>{window.confirm(`确认删除站点 "${t.name||t.first_url}"？将会删除所有相关数据`)&&(()=>{new _(this.ctx).siteDel(t.id,!0).then((t=>{t&&i.remove()}))})()};i.querySelector('[data-action="site-edit-urls"]').onclick=()=>{const e=window.prompt("修改 URL (多个 URL 用逗号隔开):",t.urls_raw);null!==e&&new _(this.ctx).siteEdit(t.id,{name:t.name,urls:e}).then((()=>{this.initSiteList()})).catch((t=>{window.alert(`修改失败：${t.msg||"未知错误"}`)}))};i.querySelector('[data-action="site-rename"]').onclick=()=>{const e=window.prompt("编辑站点名称：",t.name);null!==e&&new _(this.ctx).siteEdit(t.id,{name:e,urls:t.urls_raw}).then((()=>{this.initSiteList()})).catch((t=>{window.alert(`修改失败：${t.msg||"未知错误"}`)}))}})),this.el.innerHTML="",this.el.append(t)):t.append(a('<div class="atk-sidebar-no-content">无内容</div>'))}initSetting(){const t=a('<div class="atk-admin-setting"></div>'),e=a('\n    <div class="atk-setting">\n    <div class="atk-group atk-importer atk-form-wrap">\n    <div class="atk-title">导入评论数据</div>\n    <input type="file" name="importer_dataFile" accept="text/plain,.json" />\n    <div class="atk-label">数据类型：</div>\n    <select name="importer_dataType">\n      <option value="artalk_v1">Artalk v1 (PHP 旧版)</option>\n    </select>\n    <div class="atk-label">目标站点名：</div>\n    <input type="text" name="importer_siteName" />\n    <button class="atk-btn" name="importer_submit">导入</button>\n    </div>\n    </div>');t.append(e);const i=e.querySelector('[name="importer_dataFile"]'),n=e.querySelector('[name="importer_siteName"]'),s=e.querySelector('[name="importer_dataType"]'),r=e.querySelector('[name="importer_submit"]'),o=r.innerText;r.onclick=()=>{const t=n.value.trim(),e=s.value.trim();if(!i.files||0===i.files.length)return void window.alert("请打开文件");if(""===e)return void window.alert("请选择数据类型");const a=new FileReader;a.onload=()=>{const i=String(a.result);i&&(r.innerText="请稍后...",new _(this.ctx).importer(i,e,t).then((()=>{window.alert("导入成功")})).catch((t=>{console.error(t),window.alert(`导入失败：${t.msg||"未知错误"}`)})).finally((()=>{r.innerText=o})))},a.readAsText(i.files[0])},this.el.innerHTML="",this.el.append(t)}}function V(t,e){const i=a('<div class="atk-filter-bar"></div>');return t.forEach((t=>{const n=a("<span></span>");i.append(n),n.innerText=t.label,n.addEventListener("click",(()=>{e(t),i.querySelectorAll(".atk-active").forEach((t=>t.classList.remove("atk-active"))),n.classList.add("atk-active")}))})),i.firstChild.click(),i}class G extends E{el;layer;actionsEl;contentEl;titleWrapEl;view;action;isFirstShow=!0;viewInstances={};registerViews=[D,Q];constructor(t){super(t),this.el=a('<div class="atk-sidebar">\n  <div class="atk-sidebar-inner">\n    <div class="atk-sidebar-title-wrap"><span class="atk-title-item atk-active"></span></div>\n    <div class="atk-sidebar-close"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/><path d="M0 0h24v24H0z" fill="none"/></svg></div>\n    <div class="atk-sidebar-actions"></div>\n    <div class="atk-sidebar-content"></div>\n  </div>\n</div>\n'),this.contentEl=this.el.querySelector(".atk-sidebar-content"),this.titleWrapEl=this.el.querySelector(".atk-sidebar-title-wrap"),this.actionsEl=this.el.querySelector(".atk-sidebar-actions"),this.el.querySelector(".atk-sidebar-close").addEventListener("click",(()=>{this.hide()})),this.ctx.addEventListener("sidebar-show",(t=>this.show(t?.viewName))),this.ctx.addEventListener("sidebar-hide",(()=>this.hide())),this.registerViews.forEach((t=>{const e=new t(this.ctx);this.viewInstances[e.name]=e,e.el.classList.add(`atk-sidebar-view-${e.name}`);const i=a(`\n      <span class="atk-title-item" data-name="${e.name}">${e.title}</span>\n      `);e.adminOnly&&(i.setAttribute("atk-only-admin-show",""),this.ctx.user.data.isAdmin||i.classList.add("atk-hide")),this.titleWrapEl.append(i),i.addEventListener("click",(()=>{this.switchView(e)}))}))}show(t){this.el.style.transform="",this.layer=S(this.ctx,"sidebar",this.el),this.layer.show(),this.contentEl.scrollTo(0,0),setTimeout((()=>{this.el.style.transform="translate(0, 0)"}),20),t&&this.switchViewByName(t),this.isFirstShow&&(t||this.switchViewByName("message"),this.isFirstShow=!1)}hide(){this.el.style.transform="",this.layer?.dispose()}switchViewByName(t){this.viewInstances[t]?this.switchView(this.viewInstances[t]):console.error(`未找到 view: ${t}`)}switchView(t){this.view=t;const e=this.titleWrapEl.querySelector(`[data-name=${t.name}]`);this.titleWrapEl.querySelector(".atk-active").innerText=t.title,this.titleWrapEl.querySelectorAll(".atk-title-item").forEach((t=>{t.classList.contains("atk-active")||(t.style.display="")})),e.style.display="none",t.init(),this.contentEl.innerHTML="",this.contentEl.append(t.el),this.actionsEl.innerHTML="",Object.entries(t.actions).forEach((([e,i])=>{const n=a(`<span class="atk-action-item">${i}</span>`);this.actionsEl.append(n),t.activeAction===e&&n.classList.add("atk-active"),n.addEventListener("click",(()=>{t.switch(e),t.activeAction=e,this.actionsEl.querySelectorAll(".atk-active").forEach((t=>{t.classList.remove("atk-active")})),n.classList.add("atk-active")}))}))}}const Z={el:"",placeholder:"来啊，快活啊 ( ゜- ゜)",noComment:"快来成为第一个评论的人吧~",sendBtn:"发送评论",defaultAvatar:"mp",pageKey:"",server:"",site:"",emoticons:{"颜表情":{inputType:"emoticon",container:{Hi:"|´・ω・)ノ","开心":"ヾ(≧∇≦*)ゝ","星星眼":"(☆ω☆)","掀桌":"（╯‵□′）╯︵┴─┴","流口水":"￣﹃￣","捂脸":"(/ω＼)","给跪":"∠( ᐛ 」∠)＿","哈？":"(๑•̀ㅁ•́ฅ)","斜眼":"→_→","加油":"୧(๑•̀⌄•́๑)૭","有木有WiFi":"٩(ˊᗜˋ*)و","前方高能预警":"(ノ°ο°)ノ","纳尼":"(´இ皿இ｀)","吓死惹":"⌇●﹏●⌇","已阅留爪":"(ฅ´ω`ฅ)","去吧大师球":"(╯°A°)╯︵○○○","太萌惹":"φ(￣∇￣o)","咦咦咦":'ヾ(´･ ･｀｡)ノ"',"气呼呼":"( ง ᵒ̌皿ᵒ̌)ง⁼³₌₃","我受到了惊吓":"(ó﹏ò｡)","什么鬼":"Σ(っ °Д °;)っ","摸摸头":'( ,,´･ω･)ﾉ"(´っω･｀｡)',"无奈":"╮(╯▽╰)╭ ","脸红":"o(*////▽////*)q ","悲哀":"＞﹏＜","静静地看着你":'( ๑´•ω•) "(ㆆᴗㆆ)',"不要哇":"(｡•ˇ‸ˇ•｡)"}},Emoji:{inputType:"emoji",container:["😀","😃","😄","😁","😆","😅","😂","😊","😉","👀","😌","😍","😘","😋","😜","😝","😎","😏","😒","😟","😕","😖","😫","😩","😠","😲","😵","😳","😱","😨","😢","😭","😷","✋","✌️","👊","👋","👏","👍","👎","❤️","🎉","🚀"]},"滑稽":{inputType:"image",container:{"原味稽":"https://i.loli.net/2019/02/01/5c53d26b7ae13.png","还是算了":"https://i.loli.net/2020/04/30/riySFlu75fJdG4p.png","蓝纹稽":"https://i.loli.net/2020/04/30/jyh5IVzpqXsHuvU.jpg","随稽应变":"https://i.loli.net/2017/02/05/5896e6ec1d528.jpg","蠕动":"https://i.loli.net/2017/02/05/5896e9712a3c1.gif","束手无稽":"https://i.loli.net/2020/04/30/dF8sTOpgomj7qf5.jpg","微笑默叹以为妙绝":"https://i.loli.net/2019/02/01/5c53daa84f24a.png","喝嘤料":"https://i.loli.net/2019/02/01/5c53d63d8c6af.jpg","暗中观察":"https://i.loli.net/2019/02/01/5c53dd21a2e7b.jpg","高兴":"https://i.loli.net/2019/02/01/5c53d1b9e5f38.jpg","惊稽":"https://i.loli.net/2019/02/01/5c53d1e2ad89f.jpg","可这和我的帅有什么关系":"https://i.loli.net/2017/02/05/5896ece29a8e0.jpg","狱稽":"https://i.loli.net/2020/04/30/cUEQrVYGFiDjqhy.jpg","梆":"https://i.loli.net/2020/04/30/TlAGjm6IvJSMVpq.jpg","吃鱼摆摆":"https://i.loli.net/2017/02/05/5896ec2cb7f39.gif","跃跃欲试 3":"https://i.loli.net/2017/02/05/5896ece2ac5a2.gif","突然滑稽":"https://i.loli.net/2019/02/01/5c53cf2a457f1.jpg","扶墙怂":"https://i.loli.net/2017/02/05/5896ece2ab57a.jpg","阔以":"https://i.loli.net/2020/04/30/7EYyq1TcBKa3eQ2.jpg","不得行":"https://i.loli.net/2020/04/30/KoqBGauX7TEfeyn.jpg","少儿不宜":"https://i.loli.net/2020/04/30/nt2ZWRozUNjBxAK.jpg","稽日可期":"https://i.loli.net/2020/04/30/FmfYcoMJesi2Ddq.jpg","哎":"https://i.loli.net/2020/04/30/ps7PTIANgSErqnU.jpg","别看丢人":"https://i.loli.net/2019/02/01/5c53d4f89ea29.jpg","地稽 2":"https://i.loli.net/2019/02/01/5c53dbae85687.jpg","地稽":"https://i.loli.net/2020/04/30/BnTMX35EPxleVmA.jpg","老阔有点扣":"https://i.loli.net/2020/04/30/fhDXbA9T1zJPlKk.gif","啊哈哈":"https://i.loli.net/2019/02/01/5c53dc2947d84.jpg","无稽可奈":"https://i.loli.net/2020/04/30/UyxTzB2fS3LtH7Q.jpg","老实巴交":"https://i.loli.net/2020/04/30/7DgSoyqwtYBxchE.jpg","紧张":"https://i.loli.net/2017/02/05/5896e8a408253.jpg","摇摆稽":"https://i.loli.net/2019/02/01/5c53d1904dcb2.gif","又不是不能用":"https://i.loli.net/2019/02/01/5c53ce897ab55.jpg","一时滑稽":"https://i.loli.net/2019/02/01/5c53d5d28e22c.jpg","无法接受":"https://i.loli.net/2019/02/01/5c53cee8422fc.jpg","嘤雄豪稽":"https://i.loli.net/2020/04/30/sbtw6o7iKaM4Nmq.jpg","相视双稽":"https://i.loli.net/2019/02/01/5c53d5a093149.jpg","稽皮发麻":"https://i.loli.net/2017/02/05/5896ece2a019f.jpg","地稽 3":"https://i.loli.net/2019/02/01/5c53dbe510bcf.jpg","地稽委屈":"https://i.loli.net/2019/02/01/5c53d76e250da.jpg","地稽抚摸":"https://i.loli.net/2020/04/30/cavZ6nNzMPimLy7.gif","地稽捶打":"https://i.loli.net/2020/04/30/vFVPynXaHR5sitk.gif","绝望":"https://i.loli.net/2019/02/01/5c53dc0ba2303.jpg","气稽败坏":"https://i.loli.net/2019/02/01/5c53d216f3c60.jpg","当场去世":"https://i.loli.net/2020/04/30/sogxHMTFWbE2lrP.jpg","喝酒":"https://i.loli.net/2019/02/01/5c53d78c3f4a5.jpg","老衲摆摊算命":"https://i.loli.net/2017/02/05/5896ece29d8a5.gif","老哥，稳":"https://i.loli.net/2017/02/05/5896ece29ebb0.jpg","自闭稽":"https://i.loli.net/2019/02/01/5c53d6603ee24.jpg","无话可说":"https://i.loli.net/2019/02/01/5c53d6a77b7e4.jpg","跃跃欲试":"https://i.loli.net/2017/02/05/5896e9710dfd5.jpg","跃跃欲试 2":"https://i.loli.net/2019/02/01/5c53dcc057350.jpg","满脑子骚操作":"https://i.loli.net/2020/04/30/xJXcUtO2BryHAsa.gif","稽之舞":"https://i.loli.net/2019/02/01/5c53de1a4d14d.gif","将稽就稽":"https://i.loli.net/2020/04/30/KVwf8qCrZts6WOT.gif"}}},gravatar:{cdn:"https://sdn.geekzu.org/avatar/"},darkMode:!1};class K{conf;ctx;el;contextID=(new Date).getTime();checker;editor;list;sidebar;comments=[];constructor(t){console.log("\n %c Artalk v2.0.0 %c 一款简洁有趣的可拓展评论系统 \n\n%c> https://artalk.js.org\n> https://github.com/ArtalkJS/Artalk\n","color: #FFF; background: #1DAAFF; padding:5px 0;","color: #FFF; background: #656565; padding:5px 0;",""),this.conf={...Z,...t},this.conf.server=this.conf.server.replace(/\/$/,""),this.conf.pageKey||(this.conf.pageKey=window.location.href.split("#")[0]);try{const t=document.querySelector(this.conf.el);if(null===t)throw Error(`Sorry, Target element "${this.conf.el}" was not found.`);this.el=t}catch(e){throw console.error(e),new Error("Artalk config `el` error")}this.ctx=new u(this.el,this.conf),this.el.classList.add("artalk"),this.el.setAttribute("atk-run-id",this.contextID.toString()),""!==this.el.innerHTML.trim()&&(this.el.innerHTML=""),this.initDarkMode(),this.checker=new O(this.ctx),this.editor=new R(this.ctx),this.list=new N(this.ctx),this.sidebar=new G(this.ctx),this.el.appendChild(this.editor.el),this.el.appendChild(this.list.el),this.el.appendChild(this.sidebar.el),this.list.reqComments(),window.addEventListener("hashchange",(()=>{this.list.checkGoToCommentByUrlHash()})),this.ctx.addEventListener("check-admin-show-el",(()=>{const t=[];this.el.querySelectorAll("[atk-only-admin-show]").forEach((e=>t.push(e)));const{wrapEl:e}=w(this.ctx);e&&e.querySelectorAll("[atk-only-admin-show]").forEach((e=>t.push(e))),t.forEach((t=>{this.ctx.user.data.isAdmin?t.classList.remove("atk-hide"):t.classList.add("atk-hide")}))})),this.ctx.addEventListener("user-changed",(()=>{this.ctx.dispatchEvent("check-admin-show-el"),this.ctx.dispatchEvent("list-refresh-ui")}))}initDarkMode(){this.conf.darkMode?this.el.classList.add(b):this.el.classList.remove(b);const{wrapEl:t}=w(this.ctx);t&&(this.conf.darkMode?t.classList.add(b):t.classList.remove(b))}setDarkMode(t){this.ctx.conf.darkMode=t,this.initDarkMode()}openDarkMode(){this.setDarkMode(!0)}closeDarkMode(){this.setDarkMode(!1)}}export{K as default};
